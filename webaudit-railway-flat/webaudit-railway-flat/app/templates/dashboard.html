
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <h2>Dashboard</h2>
  <form id="audit-form">
    <input id="audit-url" type="url" placeholder="https://example.com" required>
    <button type="submit">Run Audit</button>
  </form>
  <hr>
  <canvas id="overallChart" width="600" height="280"></canvas>
  <canvas id="categoryChart" width="600" height="280"></canvas>

  <script>
    const latest = {{ latest|tojson }};
    const labels = latest.map(x => x.url);
    const overall = latest.map(x => x.overall);
    const perf = latest.map(x => x.perf);
    const access = latest.map(x => x.access);
    const seo = latest.map(x => x.seo);
    const bp = latest.map(x => x.bp);

    new Chart(document.getElementById('overallChart'), {
      type: 'line',
      data: { labels, datasets: [{label: 'Overall', data: overall, borderColor: 'blue'}] },
      options: {scales: {y: {beginAtZero: true, max: 100}}}
    });

    new Chart(document.getElementById('categoryChart'), {
      type: 'bar',
      data: { labels,
        datasets: [
          {label: 'Performance', data: perf, backgroundColor: 'rgba(75,192,192,0.4)'},
          {label: 'Accessibility', data: access, backgroundColor: 'rgba(255,99,132,0.4)'},
          {label: 'Best Practices', data: bp, backgroundColor: 'rgba(153,102,255,0.4)'},
          {label: 'SEO', data: seo, backgroundColor: 'rgba(255,159,64,0.4)'}
        ]
      },
      options: {scales: {y: {beginAtZero: true, max: 100}}}
    });

    document.getElementById('audit-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const url = document.getElementById('audit-url').value;
      const res = await fetch('/api/audit', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({url})});
      const data = await res.json();
      alert('Audit ' + data.status);
    });
  </script>
</body>
</html>
