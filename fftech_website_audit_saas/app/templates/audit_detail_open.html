
{% extends "base.html" %}
{% block content %}
<div class="grid">
  <!-- Left: Summary + Charts -->
  <div class="panel" style="grid-column: span 7;">
    <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:10px;">
      <div>
        <div class="card-title">Open Audit</div>
        <div class="mono">{{ website.url }}</div>
      </div>
      <div>
        <span class="badge">Health: {{ audit.health_score }}/100</span>
        <span class="badge" style="margin-left:6px;">Grade: {{ audit.grade }}</span>
      </div>
    </div>

    <!-- Charts grid -->
    <div class="grid">
      <div class="panel" style="grid-column: span 6;">
        <div class="card-title">Health Gauge</div>
        <div class="chart-wrap"><canvas id="gaugeChart"></canvas></div>
        <div class="chart-actions">
          <button class="btn" data-export="gaugeChart">Download PNG</button>
        </div>
      </div>

      <div class="panel" style="grid-column: span 6;">
        <div class="card-title">Category Scores (Bar)</div>
        <div class="chart-wrap"><canvas id="categoryBarChart"></canvas></div>
        <div class="chart-actions">
          <button class="btn" data-export="categoryBarChart">Download PNG</button>
        </div>
      </div>

      <div class="panel" style="grid-column: span 6;">
        <div class="card-title">Category Radar</div>
        <div class="chart-wrap"><canvas id="categoryRadarChart"></canvas></div>
        <div class="chart-actions">
          <button class="btn" data-export="categoryRadarChart">Download PNG</button>
        </div>
      </div>

      <div class="panel" style="grid-column: span 6;">
        <div class="card-title">Policy Checks (Pass vs Fail)</div>
        <div class="chart-wrap"><canvas id="booleanPieChart"></canvas></div>
        <div class="chart-actions">
          <button class="btn" data-export="booleanPieChart">Download PNG</button>
        </div>
      </div>

      <div class="panel" style="grid-column: span 12;">
        <div class="card-title">Numeric Metrics</div>
        <div class="chart-wrap tall"><canvas id="numericBarChart"></canvas></div>
        <div class="chart-actions">
          <button class="btn" data-export="numericBarChart">Download PNG</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Right: Executive Summary + Metrics -->
  <div class="panel" style="grid-column: span 5;">
    <div class="card-title">Executive Summary</div>
    <div class="muted" style="margin-bottom:12px;">Generated by {{ UI_BRAND_NAME }}</div>
    <div style="white-space:pre-wrap; line-height:1.4;">{{ audit.exec_summary }}</div>

    <hr class="divider">

    <div class="card-title">Top Issues</div>
    {% if audit.top_issues and audit.top_issues|length > 0 %}
      <ul class="issues">
        {% for issue in audit.top_issues %}
          <li>{{ issue }}</li>
        {% endfor %}
      </ul>
      <div style="margin-top:8px;">
        <button class="btn" id="copyIssuesBtn">Copy Issues</button>
      </div>
    {% else %}
      <div class="muted">No explicit issues reported.</div>
    {% endif %}

    <hr class="divider">

    <div style="display:flex; align-items:center; justify-content:space-between;">
      <div class="card-title">Metrics</div>
      <input id="metricFilter" class="btn input-like" placeholder="Filter metricsâ€¦" />
    </div>
    <div class="panel" style="max-height: 420px; overflow:auto;">
      <table class="metric-table" id="metricTable">
        <thead class="sticky-head">
          <tr>
            <th style="width:40%;">Metric</th>
            <th style="width:60%;">Value</th>
          </tr>
        </thead>
        <tbody>
          {% for k, v in audit.metrics.items() %}
          <tr>
            <td class="mono">{{ k }}</td>
            <td class="mono">{{ v }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<script>
  // Pass server data to our JS initializer
  window.__AUDIT__ = {{ audit | tojson }};
  window.addEventListener('DOMContentLoaded', () => {
    initAuditCharts(window.__AUDIT__);
  });
</script>
{% endblock %}
