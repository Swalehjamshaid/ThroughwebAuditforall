{% extends 'layout.html' %}

{% block title %}Audit Report: {{ website.url }}{% endblock %}

{% block content %}
<div class="report-wrapper">
    <div class="report-header">
        <div class="domain-info">
            <span class="status-tag pulse">Live Report</span>
            <h1>{{ website.url }}</h1>
            <p class="text-dim"><i class="fa-solid fa-calendar-day"></i> Analyzed on {{ audit.created_at.strftime('%B %d, %Y') }}</p>
        </div>
        <div class="report-actions">
            <a href="/report/pdf/open?url={{ website.url }}" class="btn btn-outline">
                <i class="fa-solid fa-file-pdf"></i> Download PDF
            </a>
        </div>
    </div>

    <div class="hero-grid">
        <div class="score-card main-grade">
            <div class="grade-circle">
                <span class="grade-letter">{{ audit.grade }}</span>
                <svg class="progress-ring" width="120" height="120">
                    <circle class="progress-ring__circle" stroke="var(--primary)" stroke-width="8" fill="transparent" r="52" cx="60" cy="60"/>
                </svg>
            </div>
            <div class="score-meta">
                <h2>Overall Health</h2>
                <p class="score-value">{{ audit.health_score }}<span>/100</span></p>
            </div>
        </div>

        <div class="summary-card">
            <h3><i class="fa-solid fa-bolt"></i> Executive Summary</h3>
            <p>{{ audit.exec_summary }}</p>
        </div>
    </div>

    <div class="categories-grid">
        {% for cat in audit.category_scores %}
        <div class="category-item">
            <div class="cat-header">
                <span class="cat-name">{{ cat.name }}</span>
                <span class="cat-score">{{ cat.score }}%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" style="width: {{ cat.score }}%; background: {{ 'var(--accent)' if cat.score > 70 else 'var(--warn)' if cat.score > 40 else 'var(--critical)' }}"></div>
            </div>
        </div>
        {% endfor %}
    </div>

    {% if audit.top_issues %}
    <div class="issues-section">
        <h3><i class="fa-solid fa-circle-exclamation"></i> Critical Improvements</h3>
        <div class="issues-list">
            {% for issue in audit.top_issues %}
            <div class="issue-card">
                <i class="fa-solid fa-triangle-exclamation"></i>
                <span>{{ issue }}</span>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>

<style>
    .report-wrapper { max-width: 1000px; margin: 0 auto; animation: fadeInUp 0.6s ease-out; }
    
    .report-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 3rem; }
    .status-tag { background: rgba(16, 185, 129, 0.1); color: var(--accent); padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; margin-bottom: 1rem; display: inline-block; }
    
    /* Hero Section */
    .hero-grid { display: grid; grid-template-columns: 1fr 2fr; gap: 2rem; margin-bottom: 3rem; }
    .score-card { background: var(--card-bg); padding: 2.5rem; border-radius: 24px; display: flex; align-items: center; gap: 2rem; border: 1px solid rgba(255,255,255,0.05); }
    .grade-circle { position: relative; width: 120px; height: 120px; display: flex; align-items: center; justify-content: center; }
    .grade-letter { font-size: 3.5rem; font-weight: 800; color: var(--primary); }
    .summary-card { background: rgba(255,255,255,0.02); padding: 2.5rem; border-radius: 24px; border: 1px dashed rgba(255,255,255,0.1); }
    .summary-card h3 { margin-bottom: 1rem; color: var(--primary); }

    /* Category Bars */
    .categories-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-bottom: 3rem; }
    .category-item { background: var(--card-bg); padding: 1.5rem; border-radius: 16px; }
    .cat-header { display: flex; justify-content: space-between; margin-bottom: 0.75rem; font-weight: 600; font-size: 0.9rem; }
    .progress-bar { background: rgba(255,255,255,0.05); height: 8px; border-radius: 10px; overflow: hidden; }
    .progress-fill { height: 100%; transition: width 1s ease-in-out; }

    /* Issues */
    .issues-list { display: grid; gap: 1rem; margin-top: 1.5rem; }
    .issue-card { display: flex; align-items: center; gap: 1rem; background: rgba(211, 47, 47, 0.05); border-left: 4px solid var(--critical); padding: 1.25rem; border-radius: 8px; }
    .issue-card i { color: var(--critical); }

    .pulse { animation: pulse-green 2s infinite; }
    @keyframes pulse-green { 0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(16, 185, 129, 0); } 100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); } }
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
</style>
{% endblock %}
