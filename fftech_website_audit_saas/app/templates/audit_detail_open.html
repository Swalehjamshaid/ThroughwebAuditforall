{% extends "base.html" %}
{% block title %}Open Audit â€” {{ website.url }}{% endblock %}

{% block content %}
<!-- Your beautiful layout here -->

<!-- Safe extraction of category data -->
{% set category_scores = audit.category_scores or [] %}

{% set cat_names = category_scores | map(attribute='name') | list | default([]) %}
{% set cat_values = category_scores | map(attribute='score') | list | default([]) %}

<!-- Rest of your stunning design -->

<script>
// Safe JavaScript variables
const catNames = {{ cat_names | tojson | safe }};
const catValues = {{ cat_values | tojson | safe }};

// Only render chart if we have data
if (catNames.length > 0) {
  const catCtx = document.getElementById('catChart').getContext('2d');
  new Chart(catCtx, {
    type: 'bar',
    data: {
      labels: catNames,
      datasets: [{
        data: catValues,
        backgroundColor: 'rgba(139, 92, 246, 0.8)',
        borderRadius: 12,
      }]
    },
    options: {
      responsive: true,
      scales: { y: { beginAtZero: true, max: 100 } },
      plugins: { legend: { display: false } }
    }
  });
}
</script>

<!-- Rest of page -->
{% endblock %}
