{% extends "base.html" %}
{% block content %}
<div class="row g-4">
  <div class="col-12 col-xl-4">
    <div class="card card-glass">
      <div class="card-body">
        <h5 class="card-title mb-3">Summary</h5>
        <div class="d-flex align-items-center gap-3">
          <span class="badge grade-badge grade-{{ summary.grade|lower }} flex-shrink-0">{{ summary.grade }}</span>
          <div>
            <div class="fw-bold">Last Health: {{ summary.health_score }}/100</div>
            <div class="text-muted small">Average (last 10): {{ trend.average }}/100</div>
          </div>
        </div>
        <hr>
        <h6 class="mb-2">Your Websites</h6>
        <ul class="list-group list-group-flush">
          {% for w in websites %}
            <li class="list-group-item bg-transparent d-flex align-items-center gap-2">
              <span class="text-truncate">{{ w.url }}</span>
              {% if w.last_grade %}
                <span class="badge grade-badge grade-{{ w.last_grade|lower }}">{{ w.last_grade }}</span>
              {% else %}
                <span class="badge bg-secondary">n/a</span>
              {% endif %}
              <a class="btn btn-outline-primary btn-sm ms-auto" href="/auth/audit/run/{{ w.id }}">Run Audit</a>
            </li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>

  <div class="col-12 col-xl-8">
    <div class="card card-glass">
      <div class="card-body">
        <h5 class="card-title">Trend â€” Health Score (last 10 audits)</h5>
        <canvas id="trendChart" height="120"></canvas>
      </div>
    </div>

    <div class="card card-glass mt-4">
      <div class="card-body">
        <h5 class="card-title">Schedule</h5>
        <form method="post" action="/auth/schedule" class="row g-3">
          <div class="col-md-4">
            <label class="form-label">Daily Time (HH:MM)</label>
            <input type="text" name="daily_time" class="form-control" value="{{ schedule.daily_time }}">
          </div>
          <div class="col-md-4">
            <label class="form-label">Timezone</label>
            <input type="text" name="timezone" class="form-control" value="{{ schedule.timezone }}">
          </div>
          <div class="col-md-4 d-flex align-items-end">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="enabled" name="enabled" {% if schedule.enabled %}checked{% endif %}>
              <label class="form-check-label" for="enabled">Email me daily</label>
            </div>
          </div>
          <div class="col-12">
            <button class="btn btn-primary" type="submit"><i class="bi bi-envelope-check me-1"></i> Save Schedule</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}
{% block scripts %}
<script>
FFCharts.trend('trendChart', {{ trend.labels|tojson }}, {{ trend.values|tojson }});
</script>
{% endblock %}