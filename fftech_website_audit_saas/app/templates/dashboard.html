{% extends "base.html" %}
{% block content %}
<div class="row mt-4">
    <div class="col-md-4 mb-4">
        <div class="card glass p-4 text-center">
            <h6 class="metric-label">Average Health</h6>
            <h2 class="display-4 fw-bold">{{ trend.average }}</h2>
            <div class="badge bg-primary">Grade {{ summary.grade }}</div>
        </div>
    </div>
    
    <div class="col-md-8 mb-4">
        <div class="card glass p-4 h-100">
            <h6 class="metric-label">Audit History Trend</h6>
            <canvas id="lineChart" style="max-height: 200px;"></canvas>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h4>Monitored Websites</h4>
            <a href="/auth/audit/new" class="btn btn-accent"><i class="fa-solid fa-plus me-2"></i>New Audit</a>
        </div>
        <div class="card glass">
            <table class="table table-dark table-hover mb-0">
                <thead>
                    <tr>
                        <th>Website URL</th>
                        <th>Last Grade</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for w in websites %}
                    <tr>
                        <td>{{ w.url }}</td>
                        <td><span class="badge bg-primary">{{ w.last_grade or 'N/A' }}</span></td>
                        <td><span class="text-success"><i class="fa-solid fa-circle-check me-1"></i>Active</span></td>
                        <td>
                            <a href="/auth/audit/{{ w.id }}" class="btn btn-sm btn-outline-primary">View Report</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    new Chart(document.getElementById('lineChart'), {
        type: 'line',
        data: {
            labels: {{ trend.labels|tojson }},
            datasets: [{
                label: 'Health Score',
                data: {{ trend.values|tojson }},
                borderColor: '#1ABC9C',
                tension: 0.4,
                fill: false
            }]
        },
        options: { scales: { y: { display: false }, x: { grid: { display: false }, ticks: { color: '#93a4b8' } } }, plugins: { legend: { display: false } } }
    });
</script>
{% endblock %}
