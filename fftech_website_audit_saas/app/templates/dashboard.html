
{% extends 'base.html' %}
{% block content %}
<div class="row g-4">
  <div class="col-lg-8">
    <div class="card p-3">
      <div class="d-flex justify-content-between align-items-center">
        <h2 class="h5">Overall Site Health</h2>
        <span class="badge bg-info">{{ summary.grade }}</span>
      </div>
      <div class="progress my-3">
        <div class="progress-bar" role="progressbar" style="width: {{ summary.health_score }}%" aria-valuenow="{{ summary.health_score }}" aria-valuemin="0" aria-valuemax="100"></div>
      </div>
      <canvas id="healthTrend" height="120"></canvas>
    </div>
  </div>
  <div class="col-lg-4">
    <div class="card p-3">
      <h2 class="h5">Scheduling</h2>
      <form method="post" action="/schedule">
        <div class="mb-2">
          <label class="form-label">Daily email time</label>
          <input type="time" name="daily_time" class="form-control" value="{{ schedule.daily_time or '' }}" required>
        </div>
        <div class="mb-2">
          <label class="form-label">Time zone</label>
          <input type="text" id="timezone" name="timezone" class="form-control" value="{{ schedule.timezone or '' }}" required>
        </div>
        <div class="form-check form-switch mb-2">
          <input class="form-check-input" type="checkbox" id="daily_enabled" name="daily_enabled" {% if schedule.enabled %}checked{% endif %}>
          <label class="form-check-label" for="daily_enabled">Enable daily reports</label>
        </div>
        <button class="btn btn-brand w-100">Save schedule</button>
      </form>
    </div>
  </div>
</div>

<div class="row g-4 mt-1">
  <div class="col-12">
    <div class="card p-3">
      <div class="d-flex justify-content-between align-items-center">
        <h2 class="h5">Your Websites</h2>
        <a class="btn btn-brand" href="/audit/new">Add Website</a>
      </div>
      <div class="table-responsive">
        <table class="table table-striped">
          <thead><tr><th>URL</th><th>Last Audit</th><th>Grade</th><th>Actions</th></tr></thead>
          <tbody>
            {% for w in websites %}
            <tr>
              <td><a href="/audit/{{ w.id }}">{{ w.url }}</a></td>
              <td>{{ w.last_audit_at or 'â€”' }}</td>
              <td><span class="badge bg-primary">{{ w.last_grade or 'N/A' }}</span></td>
              <td>
                <a class="btn btn-sm btn-outline-light" href="/audit/run/{{ w.id }}">Run Audit</a>
                <a class="btn btn-sm btn-outline-info" href="/report/pdf/{{ w.id }}">Download PDF</a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      <p class="text-secondary">Free tier allows up to 10 audits. After that, subscribe for $5/month.</p>
    </div>
  </div>
</div>
<script>
const ctx = document.getElementById('healthTrend');
if(ctx){
  new Chart(ctx,{type:'line',data:{labels: {{ trend.labels | safe }}, datasets:[{label:'Site Health',data: {{ trend.values | safe }}, borderColor:'#6ea8fe'}]}, options:{plugins:{legend:{display:false}}, scales:{y:{beginAtZero:true}}}});
}
</script>
{% endblock %}
