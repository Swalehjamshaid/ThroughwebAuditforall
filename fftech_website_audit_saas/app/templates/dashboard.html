{% extends 'base_register.html' %}
{% block reg_body %}
<h2 class="mb-3">Dashboard</h2>
<div class="row g-3">
  <div class="col-md-4">
    <div class="card glass p-3 kpi-card">
      <h6>Latest Grade</h6>
      <div class="display-6">{{ summary.grade|default('A') }}</div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card glass p-3 kpi-card">
      <h6>Latest Health</h6>
      <div class="display-6">{{ summary.health_score|default(88) }}/100</div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card glass p-3 kpi-card">
      <h6>Average (last 10)</h6>
      <div class="display-6">{{ trend.average|default(0) }}</div>
    </div>
  </div>
</div>

<div class="card glass p-4 mt-3">
  <h5 class="mb-3"><i class="fas fa-wave-square me-2"></i> Health Trend</h5>
  <canvas id="trendChart" height="120"></canvas>
</div>

<div class="card glass p-4 mt-3">
  <h5 class="mb-3"><i class="fas fa-globe me-2"></i> Your Websites</h5>
  <div class="row">
    {% for w in websites %}
      <div class="col-md-6 mb-3">
        <div class="card glass p-3">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <div class="fw-bold">{{ w.url }}</div>
              <div class="small-muted">Last grade: {{ w.last_grade|default('â€”') }}</div>
            </div>
            <div>
              <a class="btn btn-sm btn-outline-primary" href="/auth/audit/{{ w.id }}">View</a>
              <a class="btn btn-sm btn-outline-light" href="/auth/audit/run/{{ w.id }}">Re-run</a>
            </div>
          </div>
        </div>
      </div>
    {% endfor %}
    {% if websites|length == 0 %}
      <div class="small-muted">No websites yet. <a href="/auth/audit/new">Add one</a>.</div>
    {% endif %}
  </div>
</div>

{% endblock %}
{% block scripts_extra %}
<script>
const labels = {{ trend.labels|default([])|tojson }};
const values = {{ trend.values|default([])|tojson }};
const ctx = document.getElementById('trendChart');
new Chart(ctx, { type: 'line', data: { labels, datasets: [{ label: 'Health', data: values, borderColor: '#1ABC9C', tension:.3 }] }, options:{ scales:{ y:{ min:0, max:100 } } } });
</script>
{% endblock %}
