
{% extends "base.html" %}
{% block content %}
<div class="row g-4">
  <div class="col-12 col-lg-4">
    <div class="card h-100"><div class="card-body">
      <h5 class="mb-3">Summary</h5>
      <div class="display-6 fw-bold">{{ summary.health_score }}</div>
      <div class="text-muted">Latest grade: <span class="fw-semibold">{{ summary.grade }}</span></div>
      <hr>
      <h6>Daily schedule</h6>
      <p class="small mb-0">Time: {{ schedule.daily_time }} · TZ: {{ schedule.timezone }} · Enabled: {{ 'Yes' if schedule.enabled else 'No' }}</p>
    </div></div>
  </div>
  <div class="col-12 col-lg-8">
    <div class="card h-100"><div class="card-body">
      <h5 class="mb-3"><i class="bi bi-graph-up-arrow"></i> Health trend</h5>
      <canvas id="trendChart" height="120"></canvas>
    </div></div>
  </div>
</div>
<div class="row g-4 mt-1">
  <div class="col-12">
    <div class="card"><div class="card-body">
      <h5 class="mb-3">Your websites</h5>
      {% if websites %}
      <div class="table-responsive">
        <table class="table table-dark table-sm">
          <thead><tr><th>#</th><th>URL</th><th>Last grade</th><th>Last audit</th><th>Actions</th></tr></thead>
          <tbody>
            {% for w in websites %}
            <tr>
              <td>{{ w.id }}</td>
              <td><a href="/audit/{{ w.id }}" class="link-light">{{ w.url }}</a></td>
              <td>{{ w.last_grade or '-' }}</td>
              <td>{{ w.last_audit_at or '-' }}</td>
              <td><a class="btn btn-sm btn-outline-light" href="/audit/run/{{ w.id }}">Run audit</a></td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
        <p class="text-muted">No websites yet. <a href="/audit/new" class="link-light">Add one</a>.</p>
      {% endif %}
    </div></div>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script>
const tLabels = {{ trend.labels|tojson if trend.labels else ['No data']|tojson }};
const tValues = {{ trend.values|tojson if trend.values else [0]|tojson }};
new Chart(document.getElementById('trendChart'), {
  type: 'line',
  data: { labels: tLabels, datasets: [{ label: 'Health score', data: tValues, borderColor:'#0d6efd', backgroundColor:'rgba(13,110,253,.2)', tension:.3 }] },
  options: { scales:{ y:{ beginAtZero:true, max:100 } }, plugins:{ legend:{ display:false } } }
});
</script>
{% endblock %}
