{% extends "base.html" %}
{% block content %}
<div class="row mt-4">
    <div class="col-12 d-flex justify-content-between align-items-center mb-4">
        <h2>Report for: <span class="text-primary">{{ website.url }}</span></h2>
        <a href="/report/pdf/open?url={{ website.url }}" class="btn btn-outline-light">
            <i class="fa-solid fa-file-pdf me-2"></i>Download PDF
        </a>
    </div>

    <div class="col-md-6 mb-4">
        <div class="card glass p-4 h-100 text-center">
            <h4 class="mb-4">Health Overview</h4>
            <div style="max-width: 400px; margin: auto;">
                <canvas id="radarChart"></canvas>
            </div>
            <div class="mt-4">
                <h1 class="display-2 fw-bold text-accent">{{ audit.health_score }}</h1>
                <p class="text-secondary uppercase">Overall Health Score</p>
            </div>
        </div>
    </div>

    <div class="col-md-6 mb-4">
        <div class="card glass p-4 h-100">
            <h4 class="text-danger mb-3"><i class="fa-solid fa-triangle-exclamation me-2"></i>Critical Issues</h4>
            <ul class="list-group list-group-flush bg-transparent">
                {% for issue in audit.top_issues %}
                <li class="list-group-item bg-transparent text-white-50 border-secondary">
                    <i class="fa-solid fa-circle-xmark text-danger me-2"></i>{{ issue }}
                </li>
                {% endfor %}
            </ul>
            <div class="mt-auto pt-4">
                <a href="/auth/register" class="btn btn-accent w-100">Register to Fix These Issues</a>
            </div>
        </div>
    </div>
</div>

<script>
    const ctx = document.getElementById('radarChart');
    new Chart(ctx, {
        type: 'radar',
        data: {
            labels: [{% for cat in audit.category_scores %}'{{ cat.name }}',{% endfor %}],
            datasets: [{
                label: 'Scores',
                data: [{% for cat in audit.category_scores %}{{ cat.score }},{% endfor %}],
                fill: true,
                backgroundColor: 'rgba(26, 188, 156, 0.2)',
                borderColor: '#1ABC9C',
                pointBackgroundColor: '#1ABC9C',
            }]
        },
        options: {
            scales: { r: { angleLines: { color: '#333' }, grid: { color: '#333' }, pointLabels: { color: '#fff' }, ticks: { display: false }, min: 0, max: 100 } }
        }
    });
</script>
{% endblock %}
