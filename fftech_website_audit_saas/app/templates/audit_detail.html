
{% extends 'base.html' %}
{% block title %}Audit Detail Â· {{ audit.title }}{% endblock %}
{% block content %}
<div class="d-flex align-items-center justify-content-between mb-3"><h2>{{ audit.title }}</h2><span class="pill {% if audit.status=='Open' %}status-open{% elif audit.status=='Closed' %}status-closed{% else %}status-inprogress{% endif %}">{{ audit.status }}</span></div>
<div class="row g-4">
  <div class="col-md-4"><div class="card glass p-4 rounded-4"><div class="label">Owner</div><div class="value">{{ audit.owner }}</div></div></div>
  <div class="col-md-4"><div class="card glass p-4 rounded-4"><div class="label">Risk Score</div><div class="value">{{ audit.risk }}</div></div></div>
  <div class="col-md-4"><div class="card glass p-4 rounded-4"><div class="label">Last Updated</div><div class="value">{{ audit.updated }}</div></div></div>
</div>
<div class="row g-4 mt-1">
  <div class="col-lg-6"><div class="glass p-3 rounded-4 chart-wrap"><canvas id="severityDist" height="160"></canvas></div></div>
  <div class="col-lg-6"><div class="glass p-3 rounded-4 chart-wrap"><canvas id="statusTrend" height="160"></canvas></div></div>
</div>
<div class="glass p-4 rounded-4 mt-4">
  <h5 class="mb-3">Findings</h5>
  <div class="table-responsive">
    <table class="table align-middle"><thead><tr><th>ID</th><th>Title</th><th>Severity</th><th>Status</th><th>Owner</th><th>Due</th></tr></thead>
      <tbody>
        {% for f in findings %}
        <tr><td>{{ f.id }}</td><td>{{ f.title }}</td><td>{{ f.severity }}</td><td><span class="pill {% if f.status=='Open' %}status-open{% elif f.status=='Closed' %}status-closed{% else %}status-inprogress{% endif %}">{{ f.status }}</span></td><td>{{ f.owner }}</td><td>{{ f.due }}</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% if report_pdf %}
<div class="mt-3"><a class="btn btn-brand" href="{{ report_pdf }}">Download PDF Report</a></div>
{% endif %}
{% endblock %}
{% block scripts %}
<script>
  const sevLabels = {{ charts.severity.labels | default(['Critical','High','Medium','Low']) | tojson }};
  const sevValues = {{ charts.severity['values'] | default([1,3,6,2]) | tojson }};
  new Chart(document.getElementById('severityDist'), { type: 'polarArea', data: { labels: sevLabels, datasets: [{ data: sevValues, backgroundColor:['#ff4d6d','#ff9f1a','#feca57','#10ac84'] }]} });
  const statusLabels = {{ charts.status.labels | default(['Week 1','Week 2','Week 3','Week 4']) | tojson }};
  const statusOpen   = {{ charts.status['open'] | default([8,6,7,4]) | tojson }};
  const statusClosed = {{ charts.status['closed'] | default([2,4,5,8]) | tojson }};
  new Chart(document.getElementById('statusTrend'), { type: 'line', data: { labels: statusLabels, datasets: [ { label:'Open', data: statusOpen, borderColor:'#ff4d6d', tension:.3 }, { label:'Closed', data: statusClosed, borderColor:'#00c48c', tension:.3 } ] } });
</script>
{% endblock %}
