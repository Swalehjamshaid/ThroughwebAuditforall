
{% extends 'base.html' %}
{% block content %}
<div class="row g-3">
  <div class="col-lg-8">
    <div class="card"><div class="card-header">Interactive Charts</div><div class="card-body">
      <canvas id="lineChart" height="120"></canvas>
      <canvas id="barChart" height="120" class="mt-4"></canvas>
    </div></div>
  </div>
  <div class="col-lg-4">
    <div class="card"><div class="card-header">Summary</div><div class="card-body">
      <p><strong>Report file:</strong> {{ data.report_path or 'N/A' }}</p>
      {% if data.duration %}<p><strong>Duration:</strong> {{ data.duration }}s</p>{% endif %}
      {% if data.pdf_path %}<p><a class="btn btn-outline-primary" href="{{ data.pdf_path }}" target="_blank">Download PDF</a></p>{% endif %}
      <a class="btn btn-outline-secondary" href="/audit/graphs/{{ run_id }}">Graph Gallery</a>
      <a class="btn btn-outline-secondary" href="/audit/detail/{{ run_id }}">Table View</a>
    </div></div>
  </div>
</div>
<script>
(async () => {
  const res = await fetch('/api/report/{{ run_id }}');
  const data = await res.json();
  const series = data.series || {}; const keys = Object.keys(series);
  const colors = ['#0f62fe','#ff7f0e','#2ca02c','#d62728','#9467bd','#8c564b'];
  const datasetsLine = keys.slice(0,3).map((k, i) => ({label: k, data: series[k], borderColor: colors[i%colors.length], tension: 0.3}));
  const labels = Array.from({length: Math.max(...datasetsLine.map(d => d.data.length), 10)}, (_, i) => i+1);
  new Chart(document.getElementById('lineChart'), {type:'line', data:{labels, datasets: datasetsLine}, options:{responsive:true, plugins:{legend:{position:'bottom'}}}});
  const datasetsBar = keys.slice(0,3).map((k, i) => ({label: k, data: series[k], backgroundColor: colors[(i+2)%colors.length]}));
  new Chart(document.getElementById('barChart'), {type:'bar', data:{labels, datasets: datasetsBar}, options:{responsive:true, plugins:{legend:{position:'bottom'}}, scales:{y:{beginAtZero:true}}}});
})();
</script>
{% endblock %}
