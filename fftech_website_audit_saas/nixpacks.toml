# nixpacks.toml - Complete WeasyPrint dependencies for Railway (tested fix)

# Install ALL required native libraries
[phases.setup]
nixPkgs = [
  # Core WeasyPrint rendering
  'cairo',
  'pango',
  'gdk-pixbuf',
  # GObject & GLib (fixes gobject-2.0-0 error)
  'glib',
  'gobject-introspection',
  # Fonts & text
  'fontconfig',
  'freetype',
  'harfbuzz',
  # Images
  'libjpeg62-turbo',
  'libpng16-16',
  # XML & utils
  'libxml2',
  'libxslt',
  'shared-mime-info',
  'libffi',
  'zlib',
  # Extra safety for Pango/Cairo
  'atk',
  'gtk3'
]

# Build phase: install Python packages after system libs
[phases.build]
cmds = [
  "pip install --no-cache-dir -r requirements.txt"
]

# Start the app
[start]
cmd = "uvicorn app.main:app --host 0.0.0.0 --port $PORT"
