<!-- templates/report.html — Full Interactive Elite Report with All Charts -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FF Tech Certified Audit Report</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; background: #f8fafc; color: #1e293b; }
    .page { @apply bg-white shadow-2xl rounded-3xl p-8 lg:p-16 mb-32; }
    .grade-display { font-size: clamp(120px, 20vw, 280px); font-weight: 900; }
    canvas { max-height: 450px; width: 100% !important; }
    @media print {
      .no-print { display: none !important; }
      .page { page-break-after: always; box-shadow: none; margin: 0; padding: 40px; }
      body { background: white; }
    }
    .high { @apply bg-red-50 border-l-8 border-red-500; }
    .med { @apply bg-amber-50 border-l-8 border-amber-500; }
    .gap-bad { @apply text-red-600 font-black; }
    .gap-good { @apply text-emerald-600 font-black; }
    .roadmap-box { @apply bg-gradient-to-r from-sky-50 to-blue-50 border-l-8 border-blue-500 p-8 rounded-r-2xl shadow-lg my-8; }
  </style>
</head>
<body class="min-h-screen">

  <div class="max-w-7xl mx-auto px-6 py-12">
    <!-- Fixed PDF Button -->
    <button onclick="window.print()" class="no-print fixed bottom-8 right-8 z-50 bg-indigo-600 hover:bg-indigo-700 text-white px-8 py-5 rounded-full shadow-2xl font-bold text-lg flex items-center gap-3 transition-all hover:scale-105">
      <i class="fas fa-file-pdf text-2xl"></i> Export Certified PDF
    </button>

    <div id="reportContent" class="space-y-32"></div>
  </div>

  <script>
    // Load report data from FastAPI backend
    async function loadReport() {
      const params = new URLSearchParams(window.location.search);
      const auditId = params.get('audit_id') || 1; // fallback

      try {
        const res = await fetch(`/report-data?audit_id=${auditId}`);
        if (!res.ok) throw new Error('Failed to load report');
        const data = await res.json();
        renderFullReport(data);
      } catch (err) {
        // Demo fallback data
        const data = {
          site_url: "https://example.com",
          overall_score: 82,
          grade: "B+",
          exec_summary: "Your website demonstrates strong technical health with an overall score of 82/100 (B+). Performance is the primary growth blocker with mobile LCP at 3.2s, causing an estimated 15–22% revenue leakage due to higher bounce rates. Security posture is excellent with full header compliance. Compared to your main competitor, you are slightly slower on load times but lead in SEO depth.\n\nTop 3 Urgent Fixes:\n1. Optimize images and defer non-critical JavaScript to bring LCP under 2.5s\n2. Enable browser caching for repeat visitors\n3. Expand thin content pages for better engagement\n\nImmediate action on these priorities will unlock significant traffic and revenue growth.",
          category_scores: [
            { area: "Security", weight: "28%", score: 94 },
            { area: "Performance", weight: "27%", score: 68 },
            { area: "SEO", weight: "23%", score: 85 },
            { area: "UX", weight: "12%", score: 91 },
            { area: "Content", weight: "10%", score: 76 }
          ],
          priority_matrix: [
            { priority: "HIGH", impact: "Revenue", effort: "Medium", fix: "Optimize LCP below 2.5s (images, fonts, render-blocking)" },
            { priority: "HIGH", impact: "Speed", effort: "Low", fix: "Enable browser caching & compression" },
            { priority: "MED", impact: "Engagement", effort: "Medium", fix: "Expand thin content pages (>800 words)" }
          ],
          competitor_table: [
            { metric: "Mobile LCP", you: "3.2s", competitor: "2.1s", gap: "❌ 52% slower" },
            { metric: "Overall Score", you: "82", competitor: "88", gap: "❌ Lower" },
            { metric: "Security Score", you: "94", competitor: "91", gap: "✅ Stronger" }
          ],
          weak_areas: ["Slow Mobile LCP", "Limited Caching", "Thin Content on Blog Pages"],
          trend_data: { labels: ["Jul", "Aug", "Sep", "Oct", "Nov", "Dec"], values: [72, 75, 78, 79, 81, 82] },
          radar_data: { labels: ["Security","Performance","SEO","UX","Content"], your: [94,68,85,91,76], competitor: [91,82,88,90,80] },
          cwv_data: { lcp: 3200, cls: 0.09, tbt: 380, lcp_target: 2500, cls_target: 0.1, tbt_target: 300 }
        };
        renderFullReport(data);
      }
    }

    function renderFullReport(data) {
      const content = document.getElementById('reportContent');
      content.innerHTML = `

        <!-- Page 1: Cover -->
        <div class="page text-center">
          <div class="grade-display text-indigo-600 mb-8">${data.grade}</div>
          <h1 class="text-5xl lg:text-6xl font-black mb-8">FF Tech Certified Audit Report</h1>
          <p class="text-3xl font-bold text-indigo-700 mb-6">${data.site_url}</p>
          <p class="text-xl text-gray-600">Generated on December 25, 2025</p>
          <div class="mt-12">
            <img src="https://dummyimage.com/300x100/4f46e5/ffffff&text=FF+Tech+Certified+Seal" alt="FF Tech Certified" class="mx-auto">
          </div>
        </div>

        <!-- Page 2: Executive Summary + Weighted Score + Radar Chart -->
        <div class="page">
          <h2 class="text-4xl font-black border-b-4 border-indigo-600 pb-6 mb-12">1. AI Executive Summary</h2>
          <div class="bg-gradient-to-r from-indigo-50 to-purple-50 p-12 rounded-3xl border-l-8 border-indigo-600 mb-16 text-xl leading-relaxed">
            ${data.exec_summary.replace(/\n/g, '<br><br>')}
          </div>

          <h2 class="text-4xl font-black border-b-4 border-indigo-600 pb-6 mb-12">2. Global Health Score Breakdown</h2>
          <div class="grid lg:grid-cols-2 gap-12">
            <div class="overflow-x-auto">
              <table class="w-full border-collapse rounded-2xl overflow-hidden shadow-2xl">
                <thead class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white">
                  <tr><th class="p-6 text-left font-black">Area</th><th class="p-6 text-center">Weight</th><th class="p-6 text-right font-black">Score</th></tr>
                </thead>
                <tbody>
                  ${data.category_scores.map(c => `
                    <tr class="${c.score < 75 ? 'bg-red-50' : c.score < 85 ? 'bg-amber-50' : 'bg-emerald-50'}">
                      <td class="p-6 font-bold">${c.area}</td>
                      <td class="p-6 text-center">${c.weight}</td>
                      <td class="p-6 text-right text-3xl font-black ${c.score >= 90 ? 'text-emerald-600' : c.score >= 75 ? 'text-amber-600' : 'text-red-600'}">${c.score}/100</td>
                    </tr>
                  `).join('')}
                  <tr class="bg-gradient-to-r from-indigo-700 to-purple-700 text-white">
                    <td class="p-6 font-black text-2xl">Overall</td>
                    <td class="p-6 font-black text-xl">100%</td>
                    <td class="p-6 text-right font-black text-5xl">${data.overall_score}/100 <span class="text-4xl">(${data.grade})</span></td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="bg-gradient-to-br from-gray-50 to-indigo-50 rounded-3xl p-10 shadow-xl">
              <h3 class="text-2xl font-bold text-center mb-8">Category Strength Comparison</h3>
              <canvas id="radarChart"></canvas>
            </div>
          </div>
        </div>

        <!-- Page 3: Priority Matrix + Competitor + Trend Chart -->
        <div class="page">
          <h2 class="text-4xl font-black border-b-4 border-red-600 pb-6 mb-12">3. Priority Fix Matrix</h2>
          <div class="overflow-x-auto mb-16">
            <table class="w-full border-collapse rounded-2xl overflow-hidden shadow-2xl">
              <thead class="bg-gradient-to-r from-red-600 to-amber-600 text-white">
                <tr><th class="p-6 text-left font-black">Priority</th><th class="p-6">Impact</th><th class="p-6">Effort</th><th class="p-6 text-left">Recommended Fix</th></tr>
              </thead>
              <tbody>
                ${data.priority_matrix.map(r => `
                  <tr class="${r.priority === 'HIGH' ? 'high' : 'med'}">
                    <td class="p-6 font-black text-2xl ${r.priority === 'HIGH' ? 'text-red-600' : 'text-amber-600'}">${r.priority}</td>
                    <td class="p-6 font-bold">${r.impact}</td>
                    <td class="p-6">${r.effort}</td>
                    <td class="p-6 text-lg leading-relaxed">${r.fix}</td>
                  </tr>
                `).join('')}
              </tbody>
            </table>
          </div>

          <div class="grid lg:grid-cols-2 gap-12">
            <div>
              <h2 class="text-4xl font-black border-b-4 border-blue-600 pb-6 mb-12">4. Competitor Gap Analysis</h2>
              <table class="w-full border-collapse rounded-2xl overflow-hidden shadow-2xl">
                <thead class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white">
                  <tr><th class="p-6 text-left font-black">Metric</th><th class="p-6">You</th><th class="p-6">Competitor</th><th class="p-6 text-left">Gap</th></tr>
                </thead>
                <tbody>
                  ${data.competitor_table.map(r => `
                    <tr class="${r.gap.includes('❌') ? 'gap-bad' : 'gap-good'}">
                      <td class="p-6 font-bold">${r.metric}</td>
                      <td class="p-6 text-xl">${r.you}</td>
                      <td class="p-6">${r.competitor}</td>
                      <td class="p-6 text-3xl font-black">${r.gap}</td>
                    </tr>
                  `).join('')}
                </tbody>
              </table>
            </div>
            <div class="bg-gradient-to-br from-gray-50 to-indigo-50 rounded-3xl p-10 shadow-xl">
              <h3 class="text-2xl font-bold text-center mb-8">Health Score Trend (6 Months)</h3>
              <canvas id="trendChart"></canvas>
            </div>
          </div>
        </div>

        <!-- Page 4: Core Web Vitals + Risks + Roadmap -->
        <div class="page">
          <h2 class="text-4xl font-black border-b-4 border-amber-600 pb-6 mb-12">5. Core Web Vitals Performance</h2>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-12 mb-16 text-center">
            <div><canvas id="lcpGauge"></canvas><p class="mt-4 text-xl font-bold">LCP: ${data.cwv_data.lcp}ms</p></div>
            <div><canvas id="clsGauge"></canvas><p class="mt-4 text-xl font-bold">CLS: ${data.cwv_data.cls}</p></div>
            <div><canvas id="tbtGauge"></canvas><p class="mt-4 text-xl font-bold">TBT: ${data.cwv_data.tbt}ms</p></div>
          </div>

          <h2 class="text-4xl font-black border-b-4 border-red-600 pb-6 mb-12">6. Critical Risk Areas</h2>
          <div class="flex flex-wrap justify-center gap-8 mb-16">
            ${data.weak_areas.length ? data.weak_areas.map(a => `
              <span class="px-10 py-6 bg-red-100 text-red-800 rounded-3xl text-2xl font-black border-4 border-red-300 shadow-2xl flex items-center">
                <i class="fas fa-exclamation-triangle mr-4 text-3xl"></i>${a}
              </span>
            `).join('') : '<p class="text-4xl text-emerald-600 font-black">No Critical Risks – Excellent Health!</p>'}
          </div>

          <h2 class="text-4xl font-black border-b-4 border-emerald-600 pb-6 mb-12">7. 30-60-90 Day Action Roadmap</h2>
          <div class="grid md:grid-cols-3 gap-12">
            <div class="roadmap-box">
              <strong class="text-3xl block mb-4">30 Days: Restore Trust & Speed</strong>
              Fix security headers + optimize LCP → Reduce bounce rate by 20-30%
            </div>
            <div class="roadmap-box">
              <strong class="text-3xl block mb-4">60 Days: Drive Traffic</strong>
              SEO fixes + content expansion → 40%+ organic growth potential
            </div>
            <div class="roadmap-box">
              <strong class="text-3xl block mb-4">90 Days: Maximize Revenue</strong>
              UX & conversion optimization → 18-30% sales lift
            </div>
          </div>
        </div>
      `;

      initAllCharts(data);
    }

    // Initialize All Interactive Charts
    function initAllCharts(data) {
      // Radar Chart
      new Chart(document.getElementById('radarChart'), {
        type: 'radar',
        data: {
          labels: data.radar_data.labels,
          datasets: [
            { label: 'Your Site', data: data.radar_data.your, backgroundColor: 'rgba(79,70,229,0.2)', borderColor: '#4f46e5', pointBackgroundColor: '#4f46e5', borderWidth: 4 },
            { label: 'Competitor', data: data.radar_data.competitor, backgroundColor: 'rgba(34,197,94,0.2)', borderColor: '#22c55e', pointBackgroundColor: '#22c55e', borderWidth: 4 }
          ]
        },
        options: { responsive: true, scales: { r: { suggestedMin: 0, suggestedMax: 100, ticks: { stepSize: 20 } } }, plugins: { legend: { position: 'top', labels: { font: { size: 16 } } } } }
      });

      // Trend Line Chart
      new Chart(document.getElementById('trendChart'), {
        type: 'line',
        data: {
          labels: data.trend_data.labels,
          datasets: [{
            label: 'Health Score',
            data: data.trend_data.values,
            borderColor: '#4f46e5',
            backgroundColor: 'rgba(79,70,229,0.15)',
            tension: 0.4,
            fill: true,
            pointRadius: 8
          }]
        },
        options: {
          responsive: true,
          plugins: { legend: { display: false } },
          scales: { y: { min: 50, max: 100, grid: { color: '#e2e8f0' } }, x: { grid: { display: false } } }
        }
      });

      // Core Web Vitals Gauges
      const createGauge = (id, value, max, target, unit = '') => {
        const percent = (value / max) * 100;
        const good = value <= target;
        new Chart(document.getElementById(id), {
          type: 'doughnut',
          data: { datasets: [{ data: [percent, 100-percent], backgroundColor: [good ? '#22c55e' : '#ef4444', '#e5e7eb'], borderWidth: 0, cutout: '75%' }] },
          options: { responsive: true, plugins: { legend: { display: false }, tooltip: { enabled: false } } },
          plugins: [{
            afterDraw: chart => {
              const ctx = chart.ctx;
              ctx.textAlign = 'center';
              ctx.textBaseline = 'middle';
              const centerX = chart.width / 2;
              const centerY = chart.height / 2;
              ctx.font = 'bold 40px Inter';
              ctx.fillStyle = good ? '#22c55e' : '#ef4444';
              ctx.fillText(value + unit, centerX, centerY - 10);
              ctx.font = '16px Inter';
              ctx.fillStyle = '#6b7280';
              ctx.fillText(good ? 'Good' : 'Needs Improvement', centerX, centerY + 20);
            }
          }]
        });
      };

      createGauge('lcpGauge', data.cwv_data.lcp, 5000, data.cwv_data.lcp_target, 'ms');
      createGauge('clsGauge', data.cwv_data.cls * 1000, 500, data.cwv_data.cls_target * 1000);
      createGauge('tbtGauge', data.cwv_data.tbt, 1000, data.cwv_data.tbt_target, 'ms');
    }

    // Load on page ready
    window.addEventListener('load', loadReport);
  </script>
</body>
</html>
