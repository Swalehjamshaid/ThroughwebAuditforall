<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FF Tech Intelligence OS | Certified Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800;900&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .glass { background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(16px); border: 1px solid rgba(255,255,255,0.08); }
        .grade-glow { text-shadow: 0 0 30px rgba(99, 102, 241, 0.6); }
        .card-hover:hover { transform: translateY(-5px); transition: all 0.3s ease; border-color: rgba(99, 102, 241, 0.4); }
    </style>
</head>
<body class="bg-[#020617] text-slate-200 min-h-screen pb-20">

    <nav class="sticky top-0 z-50 glass border-b border-white/5 px-8 py-4 flex justify-between items-center">
        <div class="flex items-center gap-3">
            <div class="bg-indigo-600 p-2 rounded-xl shadow-lg shadow-indigo-500/20">
                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2.5" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
            </div>
            <span class="text-xl font-black tracking-tighter text-white uppercase">FF Tech <span class="text-indigo-500">Intelligence</span></span>
        </div>
        <div class="flex items-center gap-6">
            <div class="hidden md:block text-right">
                <p class="text-[10px] text-slate-500 uppercase font-black tracking-widest">Active Audit Target</p>
                <p class="text-sm font-mono text-indigo-400">{{ audit.website_url }}</p>
            </div>
            <a href="/audit/{{ audit.id }}/pdf" class="bg-indigo-600 hover:bg-indigo-500 text-white px-6 py-2.5 rounded-xl text-xs font-bold transition-all flex items-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                CERTIFIED PDF
            </a>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-6 pt-10">
        
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-10">
            <div class="glass p-8 rounded-[2.5rem] card-hover text-center relative overflow-hidden">
                <p class="text-slate-500 text-[10px] font-black uppercase tracking-[0.2em] mb-2">Compliance Grade</p>
                <h2 class="text-8xl font-black text-indigo-500 grade-glow italic">{{ audit.grade }}</h2>
            </div>
            <div class="glass p-8 rounded-[2.5rem] card-hover flex flex-col justify-center items-center">
                <p class="text-slate-500 text-[10px] font-black uppercase tracking-[0.2em] mb-4">Health Score</p>
                <div class="relative flex items-center justify-center">
                    <svg class="w-32 h-32 transform -rotate-90">
                        <circle cx="64" cy="64" r="58" stroke="currentColor" stroke-width="8" fill="transparent" class="text-slate-800" />
                        <circle cx="64" cy="64" r="58" stroke="currentColor" stroke-width="8" fill="transparent" 
                            stroke-dasharray="364.4" 
                            stroke-dashoffset="{{ 364.4 - (364.4 * audit.site_health_score / 100) }}" 
                            class="text-indigo-500 transition-all duration-1000" />
                    </svg>
                    <span class="absolute text-3xl font-black text-white">{{ audit.site_health_score }}%</span>
                </div>
            </div>
            <div class="glass p-8 rounded-[2.5rem] card-hover space-y-4">
                <p class="text-slate-500 text-[10px] font-black uppercase tracking-[0.2em] mb-2">Core Vitals</p>
                <div class="flex justify-between items-center">
                    <span class="text-slate-400 text-xs">Response (TTFB)</span>
                    <span class="text-white font-mono font-bold">{{ audit.metrics_summary.ttfb }}s</span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-slate-400 text-xs">Security Headers</span>
                    <span class="px-2 py-0.5 rounded text-[10px] font-bold {{ 'bg-emerald-500/20 text-emerald-400' if audit.metrics_summary.sec_csp else 'bg-red-500/20 text-red-400' }}">
                        {{ 'SECURE' if audit.metrics_summary.sec_csp else 'VULNERABLE' }}
                    </span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-slate-400 text-xs">SSL Authority</span>
                    <span class="text-emerald-400 text-xs font-bold">VERIFIED</span>
                </div>
            </div>
            <div class="glass p-8 rounded-[2.5rem] border-dashed border-indigo-500/30 flex flex-col items-center justify-center text-center">
                <div class="w-12 h-12 rounded-full border-2 border-indigo-500 flex items-center justify-center mb-3">
                    <svg class="w-6 h-6 text-indigo-500" fill="currentColor" viewBox="0 0 20 20"><path d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"/></svg>
                </div>
                <p class="text-white text-[11px] font-black uppercase tracking-widest">FF Tech Certified</p>
                <p class="text-slate-500 text-[9px] mt-1">{{ audit.finished_at.strftime('%d %b %Y | %H:%M') }}</p>
            </div>
        </div>

        <div class="glass p-10 rounded-[3rem] mb-10 relative overflow-hidden">
            <div class="absolute top-0 right-0 p-10 opacity-5">
                <svg class="w-64 h-64" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/></svg>
            </div>
            <h3 class="text-2xl font-black text-white mb-6 flex items-center gap-3">
                <span class="w-1.5 h-8 bg-indigo-500 rounded-full"></span>
                Executive Summary
            </h3>
            <p class="text-slate-300 text-lg leading-relaxed first-letter:text-5xl first-letter:font-black first-letter:text-indigo-500 first-letter:float-left first-letter:mr-3">
                {{ audit.executive_summary }}
            </p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-10">
            <div class="space-y-6">
                <h4 class="text-sm font-black text-slate-500 uppercase tracking-[0.3em]">Critical Action Items</h4>
                <div class="grid gap-4">
                    {% for weak in audit.weaknesses %}
                    <div class="glass p-5 rounded-2xl border-l-4 border-l-red-500 flex gap-4 items-center">
                        <div class="bg-red-500/10 p-2 rounded-lg">
                            <svg class="w-5 h-5 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
                        </div>
                        <span class="text-sm font-bold text-slate-200">{{ weak }}</span>
                    </div>
                    {% endfor %}
                    {% if not audit.weaknesses %}
                    <div class="glass p-5 rounded-2xl border-l-4 border-l-emerald-500 text-emerald-400 text-sm font-bold">
                        Target system optimized. No critical vulnerabilities detected.
                    </div>
                    {% endif %}
                </div>
            </div>

            <div class="space-y-6">
                <h4 class="text-sm font-black text-slate-500 uppercase tracking-[0.3em]">Intelligence Catalog</h4>
                <div class="glass p-8 rounded-[3rem] h-[350px] flex items-center justify-center">
                    <canvas id="healthChart"></canvas>
                </div>
            </div>
        </div>

        <div class="mt-12">
            <h4 class="text-sm font-black text-slate-500 uppercase tracking-[0.3em] mb-6">Accumulated Progress Trend</h4>
            <div class="glass p-10 rounded-[3rem] h-[350px]">
                <canvas id="trendChart"></canvas>
            </div>
        </div>

    </main>

    <footer class="mt-20 border-t border-white/5 py-10 text-center">
        <p class="text-slate-600 text-[10px] font-black uppercase tracking-[0.5em]">FF Tech World-Class Compliance Platform Â© 2025</p>
    </footer>

    <script>
        // RADAR CHART CONFIG
        const ctxHealth = document.getElementById('healthChart').getContext('2d');
        new Chart(ctxHealth, {
            type: 'polarArea',
            data: {
                labels: ['SEO', 'Security', 'Speed', 'Compliance', 'Vitals'],
                datasets: [{
                    data: [85, 92, {{ audit.site_health_score }}, 70, 80],
                    backgroundColor: [
                        'rgba(99, 102, 241, 0.4)',
                        'rgba(16, 185, 129, 0.4)',
                        'rgba(245, 158, 11, 0.4)',
                        'rgba(239, 68, 68, 0.4)',
                        'rgba(139, 92, 246, 0.4)'
                    ],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: { r: { display: false } },
                plugins: { legend: { position: 'right', labels: { color: '#64748b', font: { weight: '800', size: 10 } } } }
            }
        });

        // ACCUMULATED TREND LINE CHART
        const ctxTrend = document.getElementById('trendChart').getContext('2d');
        new Chart(ctxTrend, {
            type: 'line',
            data: {
                labels: ['Audit #1', 'Audit #2', 'Audit #3', 'Audit #4', 'Audit #5', 'Latest'],
                datasets: [{
                    label: 'Health Score',
                    data: [65, 68, 75, 72, 85, {{ audit.site_health_score }}],
                    borderColor: '#6366f1',
                    borderWidth: 4,
                    pointBackgroundColor: '#6366f1',
                    pointRadius: 6,
                    tension: 0.4,
                    fill: true,
                    backgroundColor: 'rgba(99, 102, 241, 0.05)'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: { min: 0, max: 100, grid: { color: 'rgba(255,255,255,0.03)' }, ticks: { color: '#475569' } },
                    x: { grid: { display: false }, ticks: { color: '#475569' } }
                },
                plugins: { legend: { display: false } }
            }
        });
    </script>
</body>
</html>
