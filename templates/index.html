<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>{{ app_name }} | AI Website Audit Platform</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root {
    --good:#16a34a;
    --warn:#f59e0b;
    --bad:#dc2626;
    --bg:#f5f7fb;
    --card:#ffffff;
}
body { font-family: 'Inter', sans-serif; background: var(--bg); margin:0; color:#1f2937; }
.container { max-width:1500px; margin:auto; padding:30px; }
.card { background:var(--card); border-radius:16px; padding:24px; margin-bottom:24px; box-shadow:0 10px 30px rgba(0,0,0,.06); }
.grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:20px; }
h1,h2,h3 { margin-bottom:10px; }
.score { font-size:48px; font-weight:700; }
.grade { display:inline-block; padding:10px 18px; border-radius:12px; font-weight:700; font-size:22px; }
.Aplus{background:#16a34a;color:#fff} .A{background:#22c55e;color:#fff} .B{background:#facc15;color:#000} .C{background:#fb923c;color:#fff} .D{background:#ef4444;color:#fff}
.good{color:var(--good);font-weight:600} .warning{color:var(--warn);font-weight:600} .critical{color:var(--bad);font-weight:700}
table { width:100%; border-collapse:collapse; margin-top:12px; }
th,td { padding:12px; border-bottom:1px solid #e5e7eb; text-align:left; }
th { background:#f1f5f9; }
.badge { padding:6px 10px; border-radius:10px; font-size:12px; font-weight:600; }
.high{background:#fee2e2;color:#991b1b} .medium{background:#fef3c7;color:#92400e} .low{background:#dcfce7;color:#166534}
footer { text-align:center; font-size:13px; color:#6b7280; margin-top:40px; }
.collapse-btn { cursor:pointer; font-weight:600; color:#2563eb; margin-bottom:10px; display:inline-block; }
.collapse-content { display:none; }
</style>
</head>
<body>
<div class="container">

<!-- HEADER -->
<div class="card">
    <h1>{{ app_name }}</h1>
    <p><strong>Website:</strong> {{ website_url }}</p>
    <p><strong>Audit Date:</strong> {{ audit_date }}</p>
    <p><strong>Audit ID:</strong> {{ audit_id }}</p>
</div>

<!-- OVERALL HEALTH -->
<div class="grid">
    <div class="card">
        <h3>Overall Website Health</h3>
        <div class="score">{{ overall_score }}%</div>
        <div class="grade {{ grade_class }}">{{ grade }}</div>
    </div>
    <div class="card">
        <h3>Risk Breakdown</h3>
        <p class="critical">Errors: {{ total_errors }}</p>
        <p class="warning">Warnings: {{ total_warnings }}</p>
        <p class="good">Notices: {{ total_notices }}</p>
    </div>
    <div class="card">
        <h3>Category Scores</h3>
        {% for cat, score in category_scores.items() %}
            <p>{{ cat }}: {{ score }}%</p>
        {% endfor %}
    </div>
</div>

<!-- EXECUTIVE SUMMARY -->
<div class="card">
    <h2>Executive Summary</h2>
    <p>{{ executive_summary_200_words }}</p>
</div>

<!-- WEAK AREAS HIGHLIGHT -->
<div class="card">
    <h2>Critical Weak Areas</h2>
    <ul>
        {% for weakness in weak_areas %}
        <li class="critical">{{ weakness }}</li>
        {% endfor %}
    </ul>
</div>

<!-- AUDIT CATEGORIES & METRICS -->
{% for category in audit_categories %}
<div class="card">
    <h2>{{ category.name }}</h2>
    <p>{{ category.description }}</p>
    <span class="collapse-btn" onclick="toggleCollapse('{{ loop.index0 }}')">Show / Hide Metrics</span>
    <div id="collapse-{{ loop.index0 }}" class="collapse-content">
        <table>
            <thead>
            <tr>
                <th>Metric</th>
                <th>Status</th>
                <th>Score</th>
                <th>Priority</th>
                <th>Why It Matters</th>
                <th>Recommendation</th>
            </tr>
            </thead>
            <tbody>
            {% for metric in category.metrics %}
            <tr>
                <td>{{ metric.name }}</td>
                <td class="{{ metric.status_class }}">{{ metric.status }}</td>
                <td>{{ metric.score }}/100</td>
                <td><span class="badge {{ metric.priority_class }}">{{ metric.priority }}</span></td>
                <td>{{ metric.impact }}</td>
                <td>{{ metric.recommendation }}</td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endfor %}

<!-- TREND ANALYSIS -->
<div class="card">
    <h2>Historical Performance Trend</h2>
    <canvas id="trendChart"></canvas>
</div>

<!-- OWNER INSIGHTS -->
<div class="card">
    <h2>Owner-Focused Insights</h2>
    <ul>
        {% for insight in owner_insights %}
        <li>{{ insight }}</li>
        {% endfor %}
    </ul>
</div>

<!-- CERTIFIED AUDIT -->
<div class="card">
    <h2>Certified Audit Report</h2>
    <p>This audit is officially certified by <strong>{{ company_name }}</strong>.</p>
    <p>Valid Until: {{ validity_date }}</p>
    <p>Certification Level: {{ grade }}</p>
</div>

<footer>
    Â© {{ current_year }} {{ company_name }} | International AI Audit SaaS
</footer>

<script>
function toggleCollapse(id){
    var content = document.getElementById('collapse-'+id);
    if(content.style.display === "block"){ content.style.display="none"; }
    else{ content.style.display="block"; }
}

// TREND CHART
const trendData = {{ trend_chart_data | safe }};
if(trendData){
    new Chart(document.getElementById('trendChart'), {
        type:'line',
        data:trendData,
        options:{responsive:true, plugins:{legend:{display:true}}}
    });
}
</script>
</body>
</html>
