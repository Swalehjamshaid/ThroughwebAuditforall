<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FF TECH | ELITE FORENSIC SUITE v6.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { background: #020617; color: #f8fafc; font-family: 'Inter', sans-serif; overflow-x: hidden; }
        .glass { background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(16px); border: 1px solid rgba(255,255,255,0.08); border-radius: 24px; }
        .neon-text { text-shadow: 0 0 10px rgba(59, 130, 246, 0.5); }
        .grade-glow { filter: drop-shadow(0 0 20px rgba(59, 130, 246, 0.3)); }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: #1e293b; border-radius: 10px; }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-7xl mx-auto space-y-8">
        <header class="text-center py-10">
            <h1 class="text-5xl md:text-7xl font-black italic tracking-tighter uppercase neon-text">
                FF TECH <span class="text-blue-500">ELITE</span>
            </h1>
            <p class="text-blue-400/60 font-mono text-xs mt-2 tracking-[0.3em] uppercase">Forensic Infrastructure Audit v6.0</p>
            
            <div class="mt-10 glass p-3 max-w-2xl mx-auto flex flex-col md:flex-row gap-3 shadow-2xl">
                <input id="urlInput" type="url" placeholder="https://example.com" 
                       class="flex-1 bg-transparent px-6 py-4 outline-none border-none text-lg">
                <button onclick="runAudit()" id="scanBtn" 
                        class="bg-blue-600 hover:bg-blue-500 transition-all px-12 py-4 rounded-xl font-black uppercase tracking-widest active:scale-95">
                    Start Sweep
                </button>
            </div>
        </header>

        <div id="loading" class="hidden glass p-12 text-center space-y-6 max-w-xl mx-auto">
            <div class="relative w-24 h-24 mx-auto">
                <div class="absolute inset-0 rounded-full border-4 border-blue-500/20"></div>
                <div class="absolute inset-0 rounded-full border-4 border-t-blue-500 animate-spin"></div>
            </div>
            <div class="space-y-2">
                <h3 class="text-xl font-bold tracking-tight" id="statusHeader">Initializing...</h3>
                <p id="log" class="text-xs text-blue-400 font-mono italic opacity-70">Establishing secure connection...</p>
            </div>
        </div>

        <div id="results" class="hidden space-y-8 animate-in fade-in slide-in-from-bottom-10 duration-700">
            
            <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
                <div class="lg:col-span-4 glass p-10 flex flex-col items-center justify-center relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-4 opacity-10 font-black text-6xl italic">ELITE</div>
                    <span id="gradeNum" class="text-9xl font-black text-blue-500 italic grade-glow">0%</span>
                    <p class="text-xs font-bold uppercase tracking-widest opacity-50 mt-2">Health Index</p>
                    <div id="execSummary" class="mt-6 text-[10px] leading-relaxed text-center opacity-70 border-t border-white/5 pt-4"></div>
                </div>

                <div class="lg:col-span-5 glass p-6 flex items-center justify-center min-h-[400px]">
                    <canvas id="radarChart"></canvas>
                </div>

                <div class="lg:col-span-3 glass p-8 flex flex-col justify-between">
                    <div>
                        <h3 class="text-xs font-bold opacity-40 uppercase tracking-[0.2em] mb-6">Strategic Pillars</h3>
                        <div id="pillarList" class="space-y-6"></div>
                    </div>
                    <button onclick="downloadPDF()" class="mt-8 w-full bg-white hover:bg-blue-50 text-black py-4 rounded-xl font-black uppercase tracking-tighter transition-all">
                        Download Forensic PDF
                    </button>
                </div>
            </div>

            <div class="space-y-4">
                <div class="flex items-center justify-between px-2">
                    <h3 class="text-xs font-bold opacity-40 uppercase tracking-[0.2em]">Detailed Forensic Matrix (66 Points)</h3>
                    <div class="flex gap-4 text-[10px] font-mono opacity-50">
                        <span class="flex items-center gap-1"><div class="w-2 h-2 bg-blue-500 rounded-full"></div> ELITE</span>
                        <span class="flex items-center gap-1"><div class="w-2 h-2 bg-rose-500 rounded-full"></div> CRITICAL</span>
                    </div>
                </div>
                <div id="matrix" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3"></div>
            </div>
        </div>
    </div>

    <script>
        let radarChart = null;
        let auditReport = null;

        async function runAudit() {
            const url = document.getElementById('urlInput').value;
            if(!url) return alert("Please enter a valid URL");

            // UI State
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('results').classList.add('hidden');
            document.getElementById('scanBtn').disabled = true;

            const logs = [
                "Establishing Handshake...",
                "Measuring TTFB Latency...",
                "Scraping DOM Structure...",
                "Analyzing 66 Forensic Points...",
                "Finalizing weighted index..."
            ];

            let i = 0;
            const logInterval = setInterval(() => {
                if(i < logs.length) {
                    document.getElementById('log').innerText = logs[i];
                    i++;
                }
            }, 800);

            try {
                const response = await fetch('/audit', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url })
                });
                auditReport = await response.json();
                
                clearInterval(logInterval);
                displayResults(auditReport);
            } catch (error) {
                alert("Audit failed. Ensure server is running.");
                document.getElementById('loading').classList.add('hidden');
            } finally {
                document.getElementById('scanBtn').disabled = false;
            }
        }

        function displayResults(data) {
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('results').classList.remove('hidden');
            
            // Score
            document.getElementById('gradeNum').innerText = data.total_grade + "%";
            document.getElementById('execSummary').innerText = data.summary;

            // Pillars
            const pList = document.getElementById('pillarList');
            pList.innerHTML = Object.entries(data.pillars).map(([name, score]) => `
                <div class="space-y-2">
                    <div class="flex justify-between text-[10px] font-bold uppercase tracking-wider">
                        <span class="opacity-60">${name}</span>
                        <span class="${score < 40 ? 'text-rose-500' : 'text-blue-400'}">${score}%</span>
                    </div>
                    <div class="h-1 w-full bg-white/5 rounded-full overflow-hidden">
                        <div class="h-full bg-blue-500 transition-all duration-1000" style="width: ${score}%"></div>
                    </div>
                </div>
            `).join('');

            // Radar Chart
            updateRadar(data.pillars);

            // Matrix
            const matrix = document.getElementById('matrix');
            matrix.innerHTML = data.metrics.map(m => `
                <div class="glass p-4 border-l-2 ${m.score > 70 ? 'border-blue-500' : m.score < 40 ? 'border-rose-500' : 'border-amber-500'} group hover:bg-white/5 transition-all">
                    <div class="text-[8px] opacity-30 font-bold uppercase mb-1">${m.category}</div>
                    <div class="text-[10px] font-bold leading-tight h-8 line-clamp-2 opacity-80">${m.name}</div>
                    <div class="text-xl font-black mt-2 italic ${m.score > 70 ? 'text-blue-400' : m.score < 40 ? 'text-rose-500' : 'text-slate-300'}">${m.score}%</div>
                </div>
            `).join('');
        }

        function updateRadar(pillars) {
            const ctx = document.getElementById('radarChart');
            if(radarChart) radarChart.destroy();
            
            radarChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: Object.keys(pillars),
                    datasets: [{
                        data: Object.values(pillars),
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderColor: '#3b82f6',
                        borderWidth: 3,
                        pointBackgroundColor: '#3b82f6',
                        pointRadius: 4
                    }]
                },
                options: {
                    scales: {
                        r: {
                            min: 0,
                            max: 100,
                            beginAtZero: true,
                            grid: { color: 'rgba(255,255,255,0.05)' },
                            angleLines: { color: 'rgba(255,255,255,0.05)' },
                            pointLabels: { color: 'rgba(255,255,255,0.4)', font: { size: 9, weight: 'bold' } },
                            ticks: { display: false }
                        }
                    },
                    plugins: { legend: { display: false } }
                }
            });
        }

        async function downloadPDF() {
            if(!auditReport) return;
            const res = await fetch('/download', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(auditReport)
            });
            const blob = await res.blob();
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Forensic_Audit_${auditReport.total_grade}.pdf`;
            a.click();
        }
    </script>
</body>
</html>
