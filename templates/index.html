<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FF TECH ELITE – Real Audit Engine</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#020617',
                        accent: '#34d399',
                        secondary: '#60a5fa',
                    }
                }
            }
        }
    </script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <style>
        .score-100 { @apply bg-green-600; }
        .score-70 { @apply bg-yellow-500; }
        .score-40 { @apply bg-red-600; }
        .gauge { transition: stroke-dashoffset 1s ease-in-out; }
    </style>
</head>
<body class="bg-primary text-white min-h-screen font-sans">

    <!-- Header -->
    <header class="bg-gradient-to-r from-slate-900 to-primary py-8 shadow-2xl">
        <div class="max-w-6xl mx-auto text-center px-6">
            <h1 class="text-5xl font-bold bg-gradient-to-r from-secondary to-accent bg-clip-text text-transparent">
                FF TECH ELITE – REAL AUDIT ENGINE
            </h1>
            <p class="mt-4 text-xl opacity-90">Real Chromium-based Website Auditor with Core Web Vitals, SEO, UX & Security Analysis</p>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-6xl mx-auto px-6 py-12">
        <!-- Input Form -->
        <div class="bg-slate-900 rounded-2xl shadow-2xl p-8 mb-12">
            <form id="auditForm" class="grid md:grid-cols-3 gap-6">
                <div class="md:col-span-2">
                    <label for="url" class="block text-sm font-medium mb-2">Website URL</label>
                    <input type="text" id="url" placeholder="https://example.com" class="w-full px-4 py-3 bg-slate-800 rounded-lg focus:ring-4 focus:ring-accent outline-none transition">
                </div>
                <div>
                    <label for="mode" class="block text-sm font-medium mb-2">Device Mode</label>
                    <select id="mode" class="w-full px-4 py-3 bg-slate-800 rounded-lg focus:ring-4 focus:ring-accent outline-none">
                        <option value="desktop">Desktop</option>
                        <option value="mobile">Mobile</option>
                    </select>
                </div>
                <div class="md:col-span-3 flex items-end">
                    <button type="submit" class="w-full md:w-auto px-12 py-3 bg-gradient-to-r from-accent to-secondary text-primary font-bold rounded-lg hover:opacity-90 transition flex items-center justify-center gap-3">
                        <i class="fas fa-search"></i> Run Audit
                    </button>
                </div>
            </form>
            <div id="loading" class="hidden mt-8 text-center">
                <i class="fas fa-spinner fa-spin text-4xl text-accent"></i>
                <p class="mt-4 text-lg">Auditing your website... This may take 30-60 seconds.</p>
            </div>
        </div>

        <!-- Results Section (Hidden initially) -->
        <div id="results" class="hidden">

            <!-- Overall Score -->
            <div class="bg-slate-900 rounded-2xl shadow-2xl p-8 mb-12 text-center">
                <h2 class="text-3xl font-bold mb-6">Overall Score</h2>
                <div class="relative inline-block">
                    <svg class="w-64 h-64 transform -rotate-90">
                        <circle cx="128" cy="128" r="110" stroke="#1e293b" stroke-width="30" fill="none"/>
                        <circle id="overallGauge" cx="128" cy="128" r="110" stroke="#34d399" stroke-width="30" fill="none" stroke-dasharray="691" stroke-dashoffset="691" class="gauge"/>
                    </svg>
                    <div class="absolute inset-0 flex items-center justify-center">
                        <span id="overallScore" class="text-6xl font-bold">0</span><span class="text-4xl">%</span>
                    </div>
                </div>
                <p id="urlDisplay" class="mt-6 text-xl opacity-80"></p>
                <p id="modeDisplay" class="text-lg opacity-60"></p>
                <button id="downloadPdf" class="mt-8 px-8 py-3 bg-accent text-primary font-bold rounded-lg hover:opacity-90 transition flex items-center gap-3 mx-auto">
                    <i class="fas fa-download"></i> Download PDF Report
                </button>
            </div>

            <!-- Pillar Scores -->
            <div class="grid md:grid-cols-4 gap-8 mb-12">
                <div class="bg-slate-900 rounded-xl p-6 text-center shadow-lg">
                    <h3 class="text-xl font-semibold mb-4">Performance</h3>
                    <div class="text-5xl font-bold" id="pillarPerformance">0%</div>
                </div>
                <div class="bg-slate-900 rounded-xl p-6 text-center shadow-lg">
                    <h3 class="text-xl font-semibold mb-4">SEO</h3>
                    <div class="text-5xl font-bold" id="pillarSEO">0%</div>
                </div>
                <div class="bg-slate-900 rounded-xl p-6 text-center shadow-lg">
                    <h3 class="text-xl font-semibold mb-4">UX</h3>
                    <div class="text-5xl font-bold" id="pillarUX">0%</div>
                </div>
                <div class="bg-slate-900 rounded-xl p-6 text-center shadow-lg">
                    <h3 class="text-xl font-semibold mb-4">Security</h3>
                    <div class="text-5xl font-bold" id="pillarSecurity">0%</div>
                </div>
            </div>

            <!-- Metrics Table -->
            <div class="bg-slate-900 rounded-2xl shadow-2xl p-8 overflow-x-auto">
                <h2 class="text-3xl font-bold mb-8">Detailed Metrics</h2>
                <table class="w-full text-left">
                    <thead>
                        <tr class="border-b border-slate-700">
                            <th class="py-4 px-2">#</th>
                            <th class="py-4 px-6">Metric Name</th>
                            <th class="py-4 px-6">Category</th>
                            <th class="py-4 px-6 text-right">Score</th>
                            <th class="py-4 px-6 text-center">Status</th>
                        </tr>
                    </thead>
                    <tbody id="metricsTable"></tbody>
                </table>
            </div>
        </div>
    </main>

    <script>
        const API_BASE = window.location.origin; // Adjust if backend is on different port

        document.getElementById('auditForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const url = document.getElementById('url').value.trim();
            const mode = document.getElementById('mode').value;

            if (!url) return alert('Please enter a URL');

            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('results').classList.add('hidden');

            try {
                const response = await fetch(`${API_BASE}/audit`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url, mode })
                });

                if (!response.ok) throw new Error('Audit failed');

                const data = await response.json();

                // Populate results
                document.getElementById('overallScore').textContent = data.total_grade;
                document.getElementById('urlDisplay').textContent = data.url;
                document.getElementById('modeDisplay').textContent = `Mode: ${data.mode.titleCase()}`;

                document.getElementById('pillarPerformance').textContent = data.pillars.Performance + '%';
                document.getElementById('pillarSEO').textContent = data.pillars.SEO + '%';
                document.getElementById('pillarUX').textContent = data.pillars.UX + '%';
                document.getElementById('pillarSecurity').textContent = data.pillars.Security + '%';

                // Gauge animation
                const circumference = 691;
                const offset = circumference - (data.total_grade / 100) * circumference;
                document.getElementById('overallGauge').style.strokeDashoffset = offset;

                // Metrics table
                const tbody = document.getElementById('metricsTable');
                tbody.innerHTML = '';
                data.metrics.forEach(m => {
                    const tr = document.createElement('tr');
                    tr.classList.add('border-b', 'border-slate-800');
                    const statusClass = m.score === 100 ? 'score-100' : m.score === 70 ? 'score-70' : 'score-40';
                    const statusText = m.score === 100 ? 'Excellent' : m.score === 70 ? 'Good' : 'Needs Improvement';
                    tr.innerHTML = `
                        <td class="py-4 px-2">${m.no}</td>
                        <td class="py-4 px-6">${m.name}</td>
                        <td class="py-4 px-6">${m.category}</td>
                        <td class="py-4 px-6 text-right font-semibold">${m.score}%</td>
                        <td class="py-4 px-6 text-center"><span class="inline-block px-4 py-1 rounded-full text-primary font-medium ${statusClass}">${statusText}</span></td>
                    `;
                    tbody.appendChild(tr);
                });

                // Store data for PDF download
                window.auditData = data;

                document.getElementById('results').classList.remove('hidden');
            } catch (err) {
                alert('Error: ' + err.message);
            } finally {
                document.getElementById('loading').classList.add('hidden');
            }
        });

        document.getElementById('downloadPdf').addEventListener('click', async () => {
            if (!window.auditData) return;
            const response = await fetch(`${API_BASE}/download`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(window.auditData)
            });
            if (response.ok) {
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'FFTechElite_Audit_Report.pdf';
                a.click();
            }
        });

        String.prototype.titleCase = function() {
            return this.charAt(0).toUpperCase() + this.slice(1);
        };
    </script>
</body>
</html>
