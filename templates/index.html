
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>FF Tech Intelligence | {{ audit.website.url if audit.website else audit.website_url }}</title>

  <!-- UI libraries -->
  https://cdn.tailwindcss.com</script>
  https://cdn.jsdelivr.net/npm/chart.js</script>
  https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css
  https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap

  <style>
    :root {
      --primary: #6366f1;
      --secondary: #a855f7;
      --success: #10b981;
      --danger: #ef4444;
      --surface: #ffffff;
    }

    body {
      font-family: 'Plus Jakarta Sans', sans-serif;
      background-color: #f8fafc;
      background-image:
        radial-gradient(at 0% 0%, rgba(99, 102, 241, 0.05) 0, transparent 50%),
        radial-gradient(at 50% 0%, rgba(168, 85, 247, 0.05) 0, transparent 50%);
      color: #0f172a;
    }

    .glass-card {
      background: rgba(255,255,255,0.8);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(255,255,255,0.3);
      border-radius: 2rem;
      box-shadow: 0 10px 15px -3px rgba(0,0,0,0.05);
    }

    .grade-sphere {
      width: 280px;
      height: 280px;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 20px 40px rgba(99,102,241,0.3);
      position: relative;
    }

    .grade-text {
      font-size: 8rem;
      font-weight: 800;
      color: white;
      text-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    @media print {
      .no-print { display: none !important; }
      body { background: white; padding: 0; }
      .glass-card { border: 1px solid #e2e8f0; box-shadow: none; break-inside: avoid; }
    }
  </style>
</head>
<body class="p-6 md:p-12 lg:p-20">

  <div class="max-w-7xl mx-auto">

    <!-- Header -->
    <header class="flex justify-between items-center mb-16 no-print">
      <div class="flex items-center gap-4">
        <div class="h-14 w-14 bg-indigo-600 rounded-2xl flex items-center justify-center text-white font-black text-2xl shadow-xl shadow-indigo-200">FF</div>
        <div>
          <h1 class="text-2xl font-extrabold tracking-tight">ELITE <span class="text-indigo-600">AUDIT</span></h1>
          <p class="text-xs font-bold text-slate-400 tracking-widest uppercase">Intelligence OS v1.0</p>
        </div>
      </div>
      <div class="flex gap-4">
        <button onclick="window.print()" class="bg-slate-900 text-white px-10 py-4 rounded-2xl font-bold shadow-2xl hover:bg-slate-800 transition-all flex items-center gap-3">
          <i class="fas fa-file-export"></i> Export Intelligence Brief
        </button>
      </div>
    </header>

    <!-- Grade + KPI -->
    <div class="grid lg:grid-cols-12 gap-10 mb-12">
      <div class="lg:col-span-5 glass-card p-12 flex flex-col items-center justify-center text-center">
        <div class="grade-sphere mb-8">
          <span class="grade-text">{{ audit.grade }}</span>
        </div>
        <h2 class="text-3xl font-extrabold text-slate-900">{{ audit.website.url if audit.website else audit.website_url }}</h2>
        <p class="text-slate-400 font-medium mt-2">Certified Security & Technical Check</p>
      </div>

      <div class="lg:col-span-7 grid grid-cols-2 gap-6">
        <div class="glass-card p-8 flex flex-col justify-between">
          <span class="text-xs font-black uppercase tracking-widest text-indigo-500">Overall Health</span>
          <div>
            <span class="text-6xl font-black text-slate-900">{{ audit.site_health_score }}%</span>
            <div class="h-2 w-full bg-slate-100 rounded-full mt-4 overflow-hidden">
              <div class="h-full bg-indigo-500" style="width: {{ audit.site_health_score }}%"></div>
            </div>
          </div>
        </div>
        <div class="glass-card p-8 flex flex-col justify-between">
          <span class="text-xs font-black uppercase tracking-widest text-emerald-500">Stability Delta</span>
          {% if previous_audit %}
            <div>
              <span class="text-6xl font-black {{ 'text-emerald-500' if audit.site_health_score >= previous_audit.site_health_score else 'text-rose-500' }}">
                {{ "+" if audit.site_health_score >= previous_audit.site_health_score }}{{ (audit.site_health_score - previous_audit.site_health_score)|round(1) }}%
              </span>
              <p class="text-slate-400 text-sm mt-2 font-medium">Since last scan</p>
            </div>
          {% else %}
            <span class="text-2xl font-bold text-slate-300 italic">Baseline Set</span>
          {% endif %}
        </div>
        <div class="col-span-2 glass-card p-8 flex items-center justify-between bg-slate-900 text-white">
          <div class="flex items-center gap-6">
            <div class="h-16 w-16 bg-white/10 rounded-2xl flex items-center justify-center">
              <i class="fas fa-fingerprint text-indigo-400 text-3xl"></i>
            </div>
            <div>
              <p class="text-sm font-bold opacity-50 uppercase tracking-widest">Digital Signature</p>
              <p class="text-xl font-mono">AUTH-FF-{{ audit.id }}-{{ audit.finished_at.strftime('%Y') }}</p>
            </div>
          </div>
          <div class="text-right no-print">
            <p class="text-xs font-bold opacity-50 uppercase mb-1">Audit Status</p>
            <span class="px-4 py-1 bg-emerald-500/20 text-emerald-400 border border-emerald-500/30 rounded-full text-xs font-bold">CERTIFIED</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Radar + Summary -->
    <div class="grid lg:grid-cols-2 gap-10 mb-12">
      <div class="glass-card p-10">
        <h3 class="text-xl font-bold mb-8 flex items-center gap-3">
          <i class="fas fa-chart-pie text-indigo-500"></i> Category Intensity Radar
        </h3>
        <div class="h-[400px]">
          <canvas id="radarChart"></canvas>
        </div>
      </div>
      <div class="glass-card p-10">
        <h3 class="text-xl font-bold mb-8 flex items-center gap-3">
          <i class="fas fa-wave-square text-indigo-500"></i> Strategic AI Summary
        </h3>
        <div class="relative">
          <i class="fas fa-quote-left absolute -top-4 -left-2 text-indigo-100 text-6xl"></i>
          <p class="relative text-xl leading-relaxed text-slate-600 italic">
            {{ audit.executive_summary }}
          </p>
        </div>
        <div class="mt-10 grid grid-cols-2 gap-4">
          <div class="p-5 bg-slate-50 rounded-2xl border border-slate-100">
            <p class="text-[10px] font-black text-slate-400 uppercase">Response Time</p>
            <p class="text-2xl font-bold">{{ audit.metrics_summary.ttfb_seconds }}s</p>
          </div>
          <div class="p-5 bg-slate-50 rounded-2xl border border-slate-100">
            <p class="text-[10px] font-black text-slate-400 uppercase">Page Weight</p>
            <p class="text-2xl font-bold">{{ (audit.metrics_summary.total_page_size_bytes / 1024 / 1024)|round(2) }} MB</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Weaknesses -->
    <div class="glass-card p-10 border-t-8 border-rose-500">
      <h3 class="text-2xl font-black text-rose-500 mb-8 flex items-center gap-3">
        <i class="fas fa-skull-crossbones"></i> High-Priority Vulnerabilities
      </h3>
      <div class="grid md:grid-cols-2 gap-6">
        {% for weakness in audit.weaknesses %}
        <div class="group flex items-center gap-6 p-6 bg-slate-50 rounded-3xl border border-slate-100 hover:bg-rose-50 hover:border-rose-100 transition-all">
          <div class="h-12 w-12 bg-white rounded-2xl flex items-center justify-center text-rose-500 shadow-sm group-hover:bg-rose-500 group-hover:text-white transition-all">
            <i class="fas fa-exclamation-circle text-xl"></i>
          </div>
          <span class="text-lg font-bold text-slate-700 group-hover:text-rose-900">{{ weakness }}</span>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>

  <!-- Charts -->
  <script>
    const metrics = {{ audit.metrics_summary | tojson }};
    const ctxRadar = document.getElementById('radarChart').getContext('2d');
    new Chart(ctxRadar, {
      type: 'radar',
      data: {
        labels: ['Security', 'Speed', 'SEO', 'Mobile', 'Crawl'],
        datasets: [{
          label: 'Current Cycle',
          data: [
            metrics.https ? 100 : 20,
            metrics.ttfb_seconds < 0.4 ? 100 : 50,
            metrics.title_missing ? 30 : 95,
            metrics.viewport_present ? 100 : 10,
            metrics.robots_txt_found ? 100 : 0
          ],
          backgroundColor: 'rgba(99, 102, 241, 0.15)',
          borderColor: '#6366f1',
          borderWidth: 3,
          pointBackgroundColor: '#6366f1',
          pointBorderColor: '#fff',
          pointHoverRadius: 10
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          r: {
            angleLines: { color: 'rgba(0,0,0,0.05)' },
            grid: { color: 'rgba(0,0,0,0.05)' },
            pointLabels: { font: { family: 'Plus Jakarta Sans', size: 12, weight: 'bold' } },
            ticks: { display: false },
            min: 0,
            max: 100
          }
        },
        plugins: { legend: { display: false } }
      }
    });
  </script>
</body>
</html>
``
