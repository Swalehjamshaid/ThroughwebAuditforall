<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FF Tech â€” AI Website Audit</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1"></script>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #f8fafc; }
.glass { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(10px); border: 1px solid rgba(226,232,240,1); }
.premium-blur { filter: blur(12px); pointer-events: none; }
.category-header { cursor: pointer; transition: background 0.3s; }
.category-header:hover { background: rgba(99,102,241,0.1); }
#progress-container { display: none; }
</style>
</head>
<body class="text-slate-900">

<header class="p-6 flex justify-between items-center max-w-7xl mx-auto">
    <div class="flex items-center gap-3">
        <div class="w-10 h-10 bg-indigo-600 rounded-xl flex items-center justify-center text-white text-xl">
            <i class="fas fa-shield-halved"></i>
        </div>
        <h1 class="font-extrabold text-2xl tracking-tighter">FF TECH <span class="font-normal text-slate-400 text-sm">PRO</span></h1>
    </div>
    <div id="auth-nav" class="flex gap-4">
        <button onclick="alert('Login logic')" class="font-bold text-slate-600">Login</button>
        <button onclick="alert('Join logic')" class="bg-indigo-600 text-white px-6 py-2 rounded-xl font-bold">Join</button>
    </div>
</header>

<section class="max-w-4xl mx-auto px-6 py-20 text-center">
    <h2 class="text-6xl font-extrabold mb-4 tracking-tight">Technical <span class="text-indigo-600">Audits.</span></h2>
    <p class="text-slate-500 text-lg mb-10">250+ technical checkpoints, Security analysis, and PDF exports.</p>
    <form id="audit-form" class="flex flex-col md:flex-row gap-3 p-3 glass rounded-2xl shadow-xl">
        <input id="website-url" type="url" placeholder="https://example.com" required class="flex-1 bg-transparent px-4 py-3 outline-none font-bold">
        <button type="submit" class="bg-indigo-600 text-white px-10 py-3 rounded-xl font-bold shadow-lg">ANALYZE</button>
    </form>
    <div id="progress-container" class="mt-6">
        <div class="glass p-4 rounded-xl">
            <p id="progress-text" class="font-bold text-indigo-600 mb-2">Audit Progress: 0%</p>
            <div class="w-full bg-slate-200 rounded-full h-4 overflow-hidden">
                <div id="progress-bar" class="bg-indigo-600 h-4 w-0 transition-all"></div>
            </div>
        </div>
    </div>
</section>

<section id="results" class="hidden max-w-7xl mx-auto px-6 pb-20 space-y-8">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <div class="glass p-8 rounded-[2rem] text-center flex flex-col items-center justify-center">
            <canvas id="score-gauge" width="200" height="200"></canvas>
            <h3 id="grade-badge" class="text-6xl font-black text-indigo-600 mt-4">A+</h3>
        </div>
        <div class="lg:col-span-2 glass p-10 rounded-[2rem]">
            <h3 class="text-3xl font-bold mb-4">Executive Summary</h3>
            <p id="summary-text" class="text-slate-500 leading-relaxed mb-6"></p>
            <div class="grid grid-cols-3 gap-4">
                <div class="bg-slate-50 p-4 rounded-xl text-center">
                    <p id="stat-err" class="text-2xl font-black text-rose-500">0</p>
                    <p class="text-[10px] font-bold text-slate-400">ERRORS</p>
                </div>
                <div class="bg-slate-50 p-4 rounded-xl text-center">
                    <p id="stat-warn" class="text-2xl font-black text-amber-500">0</p>
                    <p class="text-[10px] font-bold text-slate-400">WARNINGS</p>
                </div>
                <div class="bg-slate-50 p-4 rounded-xl text-center">
                    <p id="stat-not" class="text-2xl font-black text-indigo-500">0</p>
                    <p class="text-[10px] font-bold text-slate-400">NOTICES</p>
                </div>
            </div>
        </div>
    </div>

    <div id="categories-grid" class="space-y-6"></div>
</section>

<script>
const $ = s => document.querySelector(s);
let charts = {};

function categorizeMetrics(metrics) {
    const categories = { SEO: [], Perf: [], Sec: [], A11y: [] };
    metrics.forEach((m, i) => {
        const catKeys = Object.keys(categories);
        const cat = catKeys[i % catKeys.length];
        categories[cat].push(m);
    });
    return categories;
}

$('#audit-form').onsubmit = async (e) => {
    e.preventDefault();
    const url = $('#website-url').value;

    $('#progress-container').style.display = 'block';
    $('#results').classList.add('hidden');
    let progress = 0;
    $('#progress-bar').style.width = '0%';
    $('#progress-text').innerText = 'Audit Progress: 0%';

    // Simulate progressive audit
    const res = await fetch(`/audit?url=${encodeURIComponent(url)}`);
    const data = await res.json();
    const metricsCount = data.metrics.length;
    const categories = categorizeMetrics(data.metrics);

    const interval = setInterval(() => {
        progress += 1;
        if(progress > 100) progress = 100;
        $('#progress-bar').style.width = progress + '%';
        $('#progress-text').innerText = 'Audit Progress: ' + progress + '%';
        if(progress === 100) clearInterval(interval);
    }, 30);

    // Render gradually each category after 30% progress
    setTimeout(() => renderAudit(data, categories), 1000);
};

function renderAudit(data, categories) {
    $('#results').classList.remove('hidden');
    $('#progress-container').style.display = 'none';

    $('#grade-badge').innerText = data.grade;
    $('#summary-text').innerText = data.summary;
    $('#stat-err').innerText = data.errors;
    $('#stat-warn').innerText = data.warnings;
    $('#stat-not').innerText = data.notices;

    if(charts.score) charts.score.destroy();
    charts.score = new Chart($('#score-gauge'), {
        type: 'doughnut',
        data: data.overall_gauge,
        options: { cutout: '80%', plugins: { legend: { display: false } } }
    });

    const container = $('#categories-grid');
    container.innerHTML = '';

    for(const [cat, metrics] of Object.entries(categories)) {
        const catDiv = document.createElement('div');
        catDiv.className = 'glass p-6 rounded-2xl';
        catDiv.innerHTML = `<div class="category-header flex justify-between items-center p-2 mb-4 font-bold text-indigo-600 text-lg rounded cursor-pointer">
                                <span>${cat} (${metrics.length})</span>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div class="metrics-list grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"></div>`;
        container.appendChild(catDiv);

        const header = catDiv.querySelector('.category-header');
        const metricsList = catDiv.querySelector('.metrics-list');
        metricsList.style.display = 'none';
        header.onclick = () => {
            metricsList.style.display = metricsList.style.display === 'none' ? 'grid' : 'none';
        };

        metrics.forEach((m, index) => {
            setTimeout(() => {
                const mDiv = document.createElement('div');
                mDiv.className = 'glass p-4 rounded-2xl';
                mDiv.innerHTML = `<h5 class="text-[10px] font-bold text-slate-400 mb-2 tracking-widest uppercase">Signal ${m.num}</h5>
                                  <canvas id="m-${cat}-${m.num}" height="120"></canvas>`;
                metricsList.appendChild(mDiv);
                new Chart($(`#m-${cat}-${m.num}`), {
                    type: m.chart_type,
                    data: m.chart_data,
                    options: { plugins: { legend: { display: false } }, scales: { x: { display: false }, y: { display: false } } }
                });
            }, index * 20); // gradually render each metric
        });
    }
}
</script>
</body>
</html>
