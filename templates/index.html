<!DOCTYPE html>
<html lang="en" class="dark">
<head>
<meta charset="UTF-8">
<title>FF Tech Audit Command Center</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Styling -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- Charts -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-chart-treemap"></script>

</head>
<body class="bg-slate-950 text-slate-200">

<div class="max-w-7xl mx-auto p-6 space-y-12">

<!-- ================================================= -->
<!-- HEADER -->
<!-- ================================================= -->
<header class="text-center space-y-2">
<h1 class="text-3xl font-bold">FF Tech Website Audit Command Center</h1>
<p class="text-slate-400">Strict Scoring • Python Powered • Enterprise Grade</p>
</header>

<!-- ================================================= -->
<!-- NORTH STAR + ISSUE MAP -->
<!-- ================================================= -->
<section class="grid md:grid-cols-3 gap-6">

<div class="bg-slate-900 p-6 rounded-xl text-center">
<h2 class="font-semibold mb-3">Overall Health</h2>
<canvas id="healthGauge"></canvas>
<div class="mt-4 text-4xl font-bold" id="healthScore"></div>
<div class="text-sm text-slate-400" id="healthGrade"></div>
</div>

<div class="bg-slate-900 p-6 rounded-xl md:col-span-2">
<h2 class="font-semibold mb-3">Problem Map</h2>
<canvas id="issuesDonut"></canvas>
</div>

</section>

<!-- ================================================= -->
<!-- CORE WEB VITALS -->
<!-- ================================================= -->
<section class="bg-slate-900 p-6 rounded-xl">
<h2 class="font-semibold mb-3">Core Web Vitals (Speedometer)</h2>
<canvas id="cwvChart"></canvas>
</section>

<!-- ================================================= -->
<!-- CRAWL STRUCTURE -->
<!-- ================================================= -->
<section class="bg-slate-900 p-6 rounded-xl">
<h2 class="font-semibold mb-3">Crawl Depth & Structure</h2>
<canvas id="crawlTree"></canvas>
</section>

<!-- ================================================= -->
<!-- COMPETITOR + MONEY RISK -->
<!-- ================================================= -->
<section class="grid md:grid-cols-2 gap-6">

<div class="bg-slate-900 p-6 rounded-xl">
<h2 class="font-semibold mb-3">Competitor Comparison</h2>
<canvas id="competitorChart"></canvas>
</div>

<div class="bg-slate-900 p-6 rounded-xl text-center">
<h2 class="font-semibold mb-3">Estimated Money at Risk</h2>
<div id="moneyRisk" class="text-5xl font-bold text-red-400"></div>
<p class="text-sm text-slate-400 mt-2">Estimated monthly loss due to performance & errors</p>
</div>

</section>

<!-- ================================================= -->
<!-- EXECUTIVE SUMMARY -->
<!-- ================================================= -->
<section class="bg-slate-900 p-6 rounded-xl">
<h2 class="font-semibold mb-3">AI Executive Summary</h2>
<p id="executiveSummary" class="leading-relaxed text-slate-300"></p>
</section>

<!-- ================================================= -->
<!-- FIX PRIORITY HEATMAP -->
<!-- ================================================= -->
<section class="bg-slate-900 p-6 rounded-xl">
<h2 class="font-semibold mb-3">Critical Fix Priority (Impact vs Effort)</h2>
<table class="w-full text-sm">
<thead class="border-b border-slate-700">
<tr>
<th class="text-left">Metric</th>
<th>Impact</th>
<th>Effort</th>
<th>Status</th>
</tr>
</thead>
<tbody id="heatmapTable"></tbody>
</table>
</section>

<!-- ================================================= -->
<!-- FIX-IT CHECKLIST -->
<!-- ================================================= -->
<section class="bg-slate-900 p-6 rounded-xl">
<h2 class="font-semibold mb-3">Fix-It Checklist</h2>
<ul id="fixList" class="space-y-2"></ul>
<button class="mt-4 px-4 py-2 bg-emerald-600 rounded">Re-Validate</button>
</section>

<!-- ================================================= -->
<!-- MASTER METRICS TABLE -->
<!-- ================================================= -->
<section class="bg-slate-900 p-6 rounded-xl">
<h2 class="font-semibold mb-3">All Metrics (60+)</h2>
<input id="search" placeholder="Search metrics..."
class="mb-4 w-full p-2 rounded bg-slate-800">

<table class="w-full text-sm">
<thead class="border-b border-slate-700">
<tr>
<th>Category</th>
<th>Metric</th>
<th>Status</th>
<th>Impact</th>
</tr>
</thead>
<tbody id="metricsTable"></tbody>
</table>
</section>

</div>

<!-- ================================================= -->
<!-- PYTHON DATA BINDING -->
<!-- ================================================= -->
<script>
fetch("/api/audit-result")
.then(res => res.json())
.then(data => {

/* Health Gauge */
document.getElementById("healthScore").innerText = data.health + "%";
document.getElementById("healthGrade").innerText = "Grade: " + data.grade;

new Chart(healthGauge, {
type: "doughnut",
data: {
datasets: [{
data: [data.health, 100 - data.health],
backgroundColor: [data.health_color, "#1e293b"],
borderWidth: 0
}]
},
options: { cutout: "80%" }
});

/* Issue Map */
new Chart(issuesDonut, {
type: "doughnut",
data: {
labels: ["Errors","Warnings","Notices"],
datasets: [{
data: [data.errors, data.warnings, data.notices],
backgroundColor: ["#ef4444","#f59e0b","#3b82f6"]
}]
}
});

/* CWV */
new Chart(cwvChart, {
type: "bar",
data: {
labels: data.cwv.labels,
datasets: [
{ label: "Your Site", data: data.cwv.site },
{ label: "Benchmark", data: data.cwv.benchmark }
]
}
});

/* Crawl Map */
new Chart(crawlTree, {
type: "treemap",
data: {
datasets: [{
tree: data.crawl_depth,
key: "value",
groups: ["depth"]
}]
}
});

/* Competitors */
new Chart(competitorChart, {
type: "bar",
data: {
labels: data.competitors.labels,
datasets: [{
label: "Health Score",
data: data.competitors.scores
}]
}
});

/* Money Risk */
document.getElementById("moneyRisk").innerText =
"$" + data.money_risk.toLocaleString();

/* Summary */
document.getElementById("executiveSummary").innerText =
data.executive_summary;

/* Heatmap */
data.heatmap.forEach(i => {
heatmapTable.innerHTML += `
<tr class="border-b border-slate-800">
<td>${i.metric}</td>
<td>${i.impact}</td>
<td>${i.effort}</td>
<td>${i.status}</td>
</tr>`;
});

/* Fix List */
data.fix_list.forEach(f => {
fixList.innerHTML += `
<li>
<label>
<input type="checkbox" class="mr-2"> ${f}
</label>
</li>`;
});

/* Metrics Table */
data.metrics.forEach(m => {
metricsTable.innerHTML += `
<tr class="border-b border-slate-800">
<td>${m.category}</td>
<td>${m.metric}</td>
<td>${m.status}</td>
<td>${m.impact}</td>
</tr>`;
});

});
</script>

</body>
</html>
