<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>FF Tech | Enterprise Website Audit Platform</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- CDN ONLY -->
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="bg-gray-100 text-gray-900">

<!-- ======================================================
HEADER
====================================================== -->
<header class="bg-black text-white px-6 py-4 flex justify-between items-center">
  <div class="text-xl font-bold">FF Tech WebAudit</div>
  <div id="userType" class="text-sm">Public User</div>
</header>

<!-- ======================================================
PART ONE — ACCESS MODES
====================================================== -->
<section class="bg-white m-4 p-6 rounded shadow">
  <h2 class="text-xl font-bold mb-4">Access Type</h2>

  <div class="grid md:grid-cols-3 gap-4">

    <!-- OPEN -->
    <div class="border p-4 rounded">
      <h3 class="font-semibold">Open for All</h3>
      <p class="text-sm text-gray-600">
        Limited metrics · No reports · No scheduling
      </p>
    </div>

    <!-- REGISTER -->
    <div class="border p-4 rounded">
      <h3 class="font-semibold">Registered User</h3>
      <input id="emailInput" type="email"
        placeholder="Enter email"
        class="border p-2 w-full mt-2">
      <button onclick="sendLoginLink()"
        class="bg-indigo-600 text-white w-full mt-2 py-2 rounded">
        Send Login Link
      </button>
      <p class="text-xs text-gray-500 mt-2">
        10 free audits → $5/month subscription
      </p>
    </div>

    <!-- ADMIN -->
    <div class="border p-4 rounded">
      <h3 class="font-semibold">Admin</h3>
      <p class="text-sm text-gray-600">
        Users · Audits · Reports · System
      </p>
    </div>

  </div>
</section>

<!-- ======================================================
HERO SECTION
====================================================== -->
<section class="bg-gradient-to-r from-indigo-600 to-purple-700 text-white p-10 text-center">
  <h1 class="text-3xl font-bold">AI-Powered Website Audit</h1>
  <p class="mt-2">SEO · Performance · Security · Growth · ROI</p>

  <div class="flex justify-center mt-6 gap-2">
    <input id="websiteURL"
      class="p-2 rounded text-black w-80"
      placeholder="https://example.com">
    <button onclick="runAudit()"
      class="bg-black px-4 py-2 rounded">
      Run Free Audit
    </button>
  </div>
</section>

<!-- ======================================================
PROGRESS
====================================================== -->
<section class="p-6">
  <div class="w-full bg-gray-300 rounded">
    <div id="progressBar"
      class="bg-green-600 text-white text-xs text-center p-1 rounded"
      style="width:0%">Idle</div>
  </div>
</section>

<!-- ======================================================
EXECUTIVE SUMMARY
====================================================== -->
<section class="bg-white m-4 p-6 rounded shadow">
  <h2 class="text-xl font-bold">Executive Summary</h2>

  <p id="execSummary" class="mt-3 text-gray-700">
    Awaiting audit results…
  </p>

  <div class="flex items-center gap-6 mt-6">
    <div id="gradeBadge" class="text-5xl font-bold"></div>
    <canvas id="healthGauge" width="180"></canvas>
  </div>
</section>

<!-- ======================================================
METRICS DASHBOARD (ALL CATEGORIES)
====================================================== -->
<section class="p-6">
  <h2 class="text-2xl font-bold mb-4">Audit Metrics Dashboard</h2>

  <div id="metricsContainer"
    class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
  </div>
</section>

<!-- ======================================================
EMAIL SCHEDULING
====================================================== -->
<section class="bg-white m-4 p-6 rounded shadow">
  <h3 class="font-bold text-lg">Email Report Scheduling</h3>

  <div class="grid md:grid-cols-3 gap-4 mt-4">
    <select id="reportType" class="border p-2">
      <option value="daily">Daily Report</option>
      <option value="accumulated">Accumulated Report</option>
    </select>

    <input id="reportTime" type="time" class="border p-2">

    <button onclick="saveSchedule()"
      class="bg-indigo-600 text-white py-2 rounded">
      Save Schedule
    </button>
  </div>
</section>

<!-- ======================================================
SUBSCRIPTION
====================================================== -->
<section class="bg-white m-4 p-6 rounded shadow">
  <h3 class="font-bold text-lg">Subscription</h3>
  <p class="text-sm mt-1">
    Continue auditing after 10 free runs with <b>$5/month</b>.
  </p>
  <button class="bg-green-600 text-white px-4 py-2 mt-4 rounded">
    Upgrade Now
  </button>
</section>

<!-- ======================================================
ADMIN PANEL
====================================================== -->
<section class="bg-white m-4 p-6 rounded shadow">
  <h3 class="font-bold text-lg">Admin Dashboard</h3>
  <ul class="list-disc ml-5 text-sm mt-2">
    <li>User login activity</li>
    <li>Audit history</li>
    <li>Email schedules</li>
    <li>Subscriptions</li>
    <li>System health</li>
  </ul>
</section>

<!-- ======================================================
FOOTER
====================================================== -->
<footer class="bg-black text-white text-center p-4">
  © 2025 FF Tech · Certified Website Audit Reports
</footer>

<!-- ======================================================
JAVASCRIPT — PYTHON CONTROLS EVERYTHING
====================================================== -->
<script>
async function runAudit() {
  const url = websiteURL.value;
  if (!url) return alert("Enter website URL");

  progressBar.style.width = "40%";
  progressBar.innerText = "Auditing…";

  const res = await fetch("/api/audit", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({url})
  });

  const data = await res.json();
  renderAudit(data);
}

function renderAudit(data) {
  progressBar.style.width = "100%";
  progressBar.innerText = "Completed";

  execSummary.innerText = data.summary;
  gradeBadge.innerText = data.grade;
  userType.innerText = data.user_type;

  renderGauge(data.score);
  renderMetrics(data.metrics);
}

function renderGauge(score) {
  new Chart(healthGauge, {
    type: "doughnut",
    data: {
      datasets: [{
        data: [score, 100-score],
        backgroundColor: ["#16a34a", "#e5e7eb"]
      }]
    },
    options: { cutout: "70%" }
  });
}

function renderMetrics(metrics) {
  metricsContainer.innerHTML = "";

  Object.values(metrics).forEach(m => {
    const card = document.createElement("div");
    card.className = "bg-white p-4 rounded shadow border-l-4";
    card.style.borderColor =
      m.status === "green" ? "#16a34a" :
      m.status === "yellow" ? "#eab308" : "#dc2626";

    card.innerHTML = `
      <h4 class="font-bold">${m.number}. ${m.name}</h4>
      <div class="text-2xl font-bold">${m.value} ${m.unit || ""}</div>
      <canvas id="metric_${m.number}" height="80"></canvas>
    `;

    metricsContainer.appendChild(card);

    new Chart(document.getElementById(`metric_${m.number}`), {
      type: "line",
      data: {
        labels: m.trend.map((_, i) => i + 1),
        datasets: [{
          data: m.trend,
          borderColor: "#6366f1"
        }]
      },
      options: {
        plugins: { legend: { display: false } },
        scales: { y: { beginAtZero: true } }
      }
    });
  });
}

function sendLoginLink() {
  fetch("/api/register", { method: "POST" });
  alert("Login link sent");
}

function saveSchedule() {
  fetch("/api/schedule", { method: "POST" });
  alert("Schedule saved");
}
</script>

</body>
</html>
