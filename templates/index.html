INDEX_HTML = r"""<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>FF TECH ELITE v3 | World's Most Advanced Web Audit</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <style>
    body { font-family: 'Inter', sans-serif; background: #0f172a; color: #e2e8f0; }
    .gradient-bg { background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); }
    .card { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(59, 130, 246, 0.2); }
    .glow { box-shadow: 0 0 30px rgba(16, 185, 129, 0.4); }
    .progress-bar { height: 6px; background: linear-gradient(90deg, #10b981, #34d399); border-radius: 3px; animation: progress 3s ease-in-out infinite; }
    @keyframes progress { 0% { width: 0%; } 100% { width: 100%; } }
    .pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }
    .metric-score-good { color: #34d399; }
    .metric-score-medium { color: #fbbf24; }
    .metric-score-bad { color: #f87171; }
  </style>
</head>
<body class="min-h-screen gradient-bg">
  <!-- Hero -->
  <div class="container mx-auto px-6 py-16 text-center">
    <h1 class="text-6xl font-black text-transparent bg-clip-text bg-gradient-to-r from-emerald-400 to-cyan-400 mb-6">
      FF TECH ELITE v3
    </h1>
    <p class="text-2xl text-slate-300 mb-12 max-w-4xl mx-auto">
      The World's Most Advanced Website Audit Engine<br>
      300+ Weighted Metrics • Lighthouse + Real Browser • Enterprise PDF Reports
    </p>
    <div class="max-w-3xl mx-auto">
      <div class="card rounded-2xl p-10 glow">
        <div class="grid md:grid-cols-3 gap-6 items-end">
          <div class="md:col-span-2">
            <input id="urlInput" type="url" placeholder="https://example.com" 
                   class="w-full px-6 py-4 rounded-xl bg-slate-800/80 border border-slate-600 focus:border-emerald-500 focus:outline-none text-lg"/>
          </div>
          <div>
            <select id="modeInput" class="w-full px-6 py-4 rounded-xl bg-slate-800/80 border border-slate-600 focus:border-emerald-500 focus:outline-none">
              <option value="desktop">Desktop Audit</option>
              <option value="mobile">Mobile Audit</option>
            </select>
          </div>
        </div>
        <button onclick="runAudit()" class="mt-8 w-full py-5 bg-gradient-to-r from-emerald-500 to-cyan-500 hover:from-emerald-600 hover:to-cyan-600 text-black font-bold text-xl rounded-xl shadow-2xl transform hover:scale-105 transition">
          Launch Full Audit
        </button>
      </div>
    </div>
  </div>

  <!-- Loading State with Moving Progress -->
  <div id="loading" class="hidden container mx-auto px-6 py-32 text-center">
    <div class="max-w-2xl mx-auto">
      <div class="card rounded-2xl p-12 glow">
        <div class="w-32 h-32 mx-auto mb-8 rounded-full bg-gradient-to-r from-emerald-500 to-cyan-500 p-1">
          <div class="w-full h-full rounded-full bg-slate-900 flex items-center justify-center">
            <i class="fas fa-search text-5xl text-emerald-400 pulse"></i>
          </div>
        </div>
        <h2 class="text-4xl font-bold mb-6">Running Elite Audit...</h2>
        <p class="text-xl text-slate-400 mb-10">Analyzing 300+ metrics using Lighthouse, DOM analysis, and real browser testing</p>
        <div class="space-y-4">
          <div class="flex items-center gap-4">
            <i class="fas fa-circle text-emerald-400"></i>
            <span>Fetching page & headers</span>
          </div>
          <div class="flex items-center gap-4">
            <i class="fas fa-circle text-emerald-400"></i>
            <span>Running Lighthouse performance audit</span>
          </div>
          <div class="flex items-center gap-4">
            <i class="fas fa-circle text-cyan-400 pulse"></i>
            <span>Executing real browser lab tests</span>
          </div>
          <div class="flex items-center gap-4">
            <i class="fas fa-circle text-slate-600"></i>
            <span>Scoring 300+ weighted metrics</span>
          </div>
          <div class="flex items-center gap-4">
            <i class="fas fa-circle text-slate-600"></i>
            <span>Generating enterprise report</span>
          </div>
        </div>
        <div class="mt-10">
          <div class="h-2 bg-slate-700 rounded-full overflow-hidden">
            <div class="progress-bar h-full"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Results -->
  <div id="results" class="hidden container mx-auto px-6 py-16 space-y-16">
    <!-- Header -->
    <div class="text-center">
      <h2 class="text-5xl font-black mb-4">Audit Complete</h2>
      <p class="text-2xl text-slate-400">Report generated for</p>
      <p id="auditedUrl" class="text-3xl font-bold text-emerald-400 mt-2">—</p>
      <p id="auditedAt" class="text-lg text-slate-500 mt-2">—</p>
    </div>

    <!-- Overall Score -->
    <div class="max-w-4xl mx-auto">
      <div class="card rounded-3xl p-16 text-center glow">
        <div id="overallScore" class="text-9xl font-black text-transparent bg-clip-text bg-gradient-to-r from-emerald-400 to-cyan-400">
          —%
        </div>
        <p class="text-3xl font-bold mt-6">Overall Site Health Score</p>
      </div>
    </div>

    <!-- Pillar Scores -->
    <div class="max-w-6xl mx-auto">
      <div class="card rounded-2xl p-10">
        <h3 class="text-3xl font-bold mb-8">Pillar Scores</h3>
        <div id="pillarScores" class="grid grid-cols-2 md:grid-cols-4 gap-8"></div>
      </div>
    </div>

    <!-- Core Web Vitals & Performance -->
    <div class="max-w-6xl mx-auto">
      <div class="card rounded-2xl p-10">
        <h3 class="text-3xl font-bold mb-8">Core Web Vitals & Performance</h3>
        <div id="perfGrid" class="grid grid-cols-2 md:grid-cols-4 gap-8"></div>
      </div>
    </div>

    <!-- Improvement Roadmap -->
    <div class="max-w-6xl mx-auto">
      <div class="card rounded-2xl p-10">
        <h3 class="text-3xl font-bold mb-8">Improvement Roadmap</h3>
        <div id="roadmap" class="prose prose-invert max-w-none text-lg leading-relaxed"></div>
      </div>
    </div>

    <!-- Advanced Diagnostics Table -->
    <div class="max-w-7xl mx-auto">
      <div class="card rounded-2xl p-10 overflow-x-auto">
        <h3 class="text-3xl font-bold mb-8">Advanced Diagnostics (300+ Metrics)</h3>
        <table class="w-full text-left">
          <thead class="bg-gradient-to-r from-emerald-600 to-cyan-600 text-black">
            <tr>
              <th class="p-4 rounded-tl-lg">#</th>
              <th class="p-4">Metric</th>
              <th class="p-4">Category</th>
              <th class="p-4 text-right">Score</th>
              <th class="p-4 text-right rounded-tr-lg">Weight</th>
            </tr>
          </thead>
          <tbody id="metricsTable" class="divide-y divide-slate-700"></tbody>
        </table>
      </div>
    </div>

    <!-- PDF Download -->
    <div class="text-center py-16">
      <button onclick="downloadPDF()" class="px-16 py-8 bg-gradient-to-r from-emerald-500 to-cyan-500 hover:from-emerald-600 hover:to-cyan-600 text-black font-black text-3xl rounded-2xl shadow-2xl transform hover:scale-110 transition flex items-center gap-6 mx-auto">
        <i class="fas fa-file-pdf text-4xl"></i>
        Download Enterprise PDF Report
      </button>
    </div>
  </div>

  <script>
    let auditData = null;

    async function runAudit() {
      const url = document.getElementById("urlInput").value.trim();
      const mode = document.getElementById("modeInput").value;
      if (!url) return alert("Please enter a URL");

      document.getElementById("results").classList.add("hidden");
      document.getElementById("loading").classList.remove("hidden");

      try {
        const res = await fetch("/audit", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ url, mode })
        });
        if (!res.ok) throw new Error(await res.text());
        auditData = await res.json();
        renderResults(auditData);
      } catch (e) {
        alert("Audit failed: " + e.message);
        console.error(e);
      } finally {
        document.getElementById("loading").classList.add("hidden");
      }
    }

    function renderResults(data) {
      document.getElementById("results").classList.remove("hidden");

      // Header
      document.getElementById("overallScore").textContent = (data.total_grade ?? "—") + "%";
      document.getElementById("auditedUrl").textContent = data.url ?? "—";
      document.getElementById("auditedAt").textContent = data.audited_at ?? "—";

      // Pillar Scores
      const pillarDiv = document.getElementById("pillarScores");
      pillarDiv.innerHTML = "";
      Object.entries(data.pillars || {}).forEach(([pillar, score]) => {
        const color = score >= 90 ? "text-emerald-400" : score >= 70 ? "text-yellow-400" : "text-red-400";
        pillarDiv.innerHTML += `
          <div class="bg-slate-800/50 rounded-xl p-8 text-center glow">
            <div class="text-slate-400 text-lg mb-2">${pillar}</div>
            <div class="text-5xl font-black ${color}">${score}%</div>
          </div>`;
      });

      // Performance Metrics
      const perfDiv = document.getElementById("perfGrid");
      perfDiv.innerHTML = "";
      Object.entries(data.perf || {}).forEach(([key, value]) => {
        perfDiv.innerHTML += `
          <div class="bg-slate-800/50 rounded-xl p-6">
            <div class="text-slate-400 text-sm mb-1">${key.replace(/_/g, ' ')}</div>
            <div class="text-2xl font-bold">${value ?? "—"}</div>
          </div>`;
      });

      // Roadmap
      document.getElementById("roadmap").innerHTML = (data.roadmap || "").replace(/&lt;/g, "<").replace(/&gt;/g, ">");

      // Metrics Table
      const tbody = document.getElementById("metricsTable");
      tbody.innerHTML = "";
      (data.metrics || []).slice(0, 100).forEach(m => {  // Show first 100 for performance
        const scoreColor = m.score >= 90 ? "metric-score-good" : m.score >= 70 ? "metric-score-medium" : "metric-score-bad";
        tbody.innerHTML += `
          <tr>
            <td class="p-4 text-slate-400">${m.no}</td>
            <td class="p-4">${m.name}</td>
            <td class="p-4 text-slate-400">${m.category}</td>
            <td class="p-4 text-right font-bold ${scoreColor}">${m.score}%</td>
            <td class="p-4 text-right text-slate-400">${m.weight}</td>
          </tr>`;
      });
    }

    async function downloadPDF() {
      if (!auditData) return alert("Run an audit first");
      try {
        const res = await fetch("/download", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(auditData)
        });
        if (!res.ok) throw new Error("PDF generation failed");
        const blob = await res.blob();
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "FF_TECH_ELITE_Audit_Report.pdf";
        a.click();
        URL.revokeObjectURL(url);
      } catch (e) {
        alert("Download failed: " + e.message);
      }
    }
  </script>
</body>
</html>"""
