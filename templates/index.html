<body class="bg-slate-950 text-white">
    <div class="max-w-6xl mx-auto p-10">
        <header class="text-center mb-16">
            <h1 class="text-6xl font-black text-blue-500 mb-2">SWALEH AUDIT</h1>
            <p class="text-slate-500 uppercase tracking-widest text-sm font-bold">Elite 57-Point Diagnostic Engine</p>
        </header>

        <div class="bg-slate-900 p-4 rounded-3xl flex gap-4 mb-16 shadow-2xl">
            <input type="text" id="url" placeholder="https://..." class="flex-1 bg-transparent px-6 py-4 text-white outline-none text-xl">
            <button onclick="runAudit()" class="bg-blue-600 hover:bg-blue-500 px-10 py-4 rounded-2xl font-bold transition-all">ANALYZE NOW</button>
        </div>

        <div id="results" class="hidden space-y-12">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="bg-slate-900 p-10 rounded-[3rem] text-center border-b-4 border-blue-500">
                    <p class="text-xs font-bold text-slate-500 uppercase tracking-widest">Global Grade</p>
                    <div id="grade" class="text-8xl font-black text-white mt-2"></div>
                </div>
                <div class="bg-slate-900 p-10 rounded-[3rem] text-center">
                    <p class="text-xs font-bold text-slate-500 uppercase tracking-widest">Efficiency Score</p>
                    <div id="score" class="text-8xl font-black text-emerald-500 mt-2"></div>
                </div>
                <div class="bg-slate-900 p-10 rounded-[3rem] flex flex-col justify-center gap-4">
                    <button onclick="downloadPDF()" class="bg-white text-black py-5 rounded-2xl font-black uppercase tracking-widest">Download Full PDF</button>
                </div>
            </div>

            <div class="grid grid-cols-2 md:grid-cols-4 gap-4" id="category-grid"></div>

            <div class="bg-slate-900 rounded-[3rem] overflow-hidden">
                <div class="p-8 border-b border-white/5 flex justify-between items-center">
                    <h3 class="text-2xl font-bold text-blue-500 uppercase tracking-tighter">Full Technical Breakdown</h3>
                    <span class="text-slate-500 font-mono text-sm uppercase font-bold">57 Points Mapped</span>
                </div>
                <div id="metrics-grid" class="grid grid-cols-1 md:grid-cols-3 gap-4 p-8 max-h-[600px] overflow-y-auto"></div>
            </div>
        </div>
    </div>

    <script>
    let lastData = null;
    async function runAudit() {
        const url = document.getElementById('url').value;
        const res = await fetch('/audit', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({url}) });
        const data = await res.json();
        lastData = data;

        document.getElementById('results').classList.remove('hidden');
        document.getElementById('grade').innerText = data.grade;
        document.getElementById('score').innerText = data.score + "%";

        // Populate Categories
        const catGrid = document.getElementById('category-grid');
        catGrid.innerHTML = Object.entries(data.cat_scores).map(([name, s]) => `
            <div class="bg-slate-900 p-6 rounded-2xl text-center border border-white/5">
                <p class="text-[10px] font-bold text-slate-500 uppercase mb-1">${name}</p>
                <p class="text-2xl font-black text-blue-400">${s}%</p>
            </div>
        `).join('');

        // Populate Metrics
        const mGrid = document.getElementById('metrics-grid');
        mGrid.innerHTML = data.metrics.map(m => `
            <div class="p-5 rounded-2xl bg-white/5 border border-white/5">
                <div class="flex justify-between text-[9px] font-bold uppercase mb-3">
                    <span class="text-blue-500">${m.category}</span>
                    <span class="${m.status==='PASS'?'text-emerald-500':'text-rose-500'}">${m.status}</span>
                </div>
                <h4 class="text-sm font-bold text-white mb-2">${m.name}</h4>
                <div class="w-full bg-slate-800 h-1 rounded-full"><div class="h-full bg-blue-500" style="width:${m.score}%"></div></div>
            </div>
        `).join('');
    }

    async function downloadPDF() {
        if(!lastData) return alert("Run audit first");
        const res = await fetch('/download', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(lastData) });
        const blob = await res.blob();
        const a = document.createElement('a');
        a.href = window.URL.createObjectURL(blob);
        a.download = "Swaleh_Audit_Report.pdf";
        a.click();
    }
    </script>
</body>
