
<!DOCTYPE html>
<html lang="en" class="h-full scroll-smooth dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>FF Tech Elite | Ultimate Website Audit</title>

<!-- Tailwind CSS -->
https://cdn.tailwindcss.com</script>
<!-- Chart.js -->
https://cdn.jsdelivr.net/npm/chart.js</script>
<style>
  body { font-family: 'Inter', sans-serif; }
  .hidden { display: none; }
  .chart-container { height: 300px; }
  .tooltip { cursor: help; border-bottom: 1px dotted; }
</style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 h-full">

<header class="bg-blue-600 dark:bg-blue-800 text-white p-4 flex justify-between items-center">
  <h1 class="text-xl font-bold">FF Tech Elite | Ultimate Website Audit</h1>
  <button id="toggle-dark" class="px-2 py-1 bg-white dark:bg-gray-700 text-blue-600 dark:text-white rounded">Toggle Dark Mode</button>
</header>

<main class="p-6 max-w-7xl mx-auto space-y-6">

  <!-- URL Audit Section -->
  <section class="p-6 bg-white dark:bg-gray-800 rounded shadow">
    <h2 class="text-2xl font-semibold mb-4">Open Audit</h2>
    <input id="audit-url" type="url" placeholder="Enter Website URL" class="w-full p-2 mb-2 rounded border border-gray-300 dark:border-gray-600">
    <button id="run-audit" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded">Run Audit</button>
    <p id="audit-status" class="mt-2 text-yellow-600 dark:text-yellow-400"></p>
  </section>

  <!-- Email Login Section -->
  <section class="p-6 bg-white dark:bg-gray-800 rounded shadow">
    <h2 class="text-2xl font-semibold mb-4">Login for Extended Audits</h2>
    <input id="email-login" type="email" placeholder="Enter your email" class="w-full p-2 mb-2 rounded border border-gray-300 dark:border-gray-600">
    <button id="send-link" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded">Send Login Link</button>
    <p id="login-status" class="mt-2 text-yellow-600 dark:text-yellow-400"></p>
  </section>

  <!-- Subscription Alert -->
  <div id="subscription-alert" class="hidden text-center bg-yellow-200 dark:bg-yellow-700 text-yellow-800 dark:text-yellow-100 p-4 rounded">
    You have reached 5 free audits. Subscribe for <strong>$5/month</strong> to continue unlimited audits.
    <button id="subscribe-btn" class="ml-4 px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">Subscribe Now</button>
  </div>

  <!-- Audit Results Section -->
  <section id="audit-results" class="hidden p-6 bg-white dark:bg-gray-800 rounded shadow space-y-6">

    <h2 class="text-2xl font-semibold mb-4">Audit Results</h2>

    <!-- Executive Summary -->
    <div class="p-4 bg-gray-50 dark:bg-gray-700 rounded">
      <h3 class="text-xl font-semibold mb-2">Executive Summary</h3>
      <p id="executive-summary">Python will populate summary here.</p>
    </div>

    <!-- Charts & Metrics -->
    <div id="metrics-container">
      <div class="p-4 bg-gray-50 dark:bg-gray-700 rounded">
        <h3 class="text-xl font-semibold mb-2">Overall Score</h3>
        <div class="chart-container mb-4"><canvas id="chart-overall-score"></canvas></div>
      </div>
      <div class="p-4 bg-gray-50 dark:bg-gray-700 rounded">
        <h3 class="text-xl font-semibold mb-2">Technical SEO</h3>
        <div class="chart-container"><canvas id="chart-technical-seo"></canvas></div>
      </div>
      <div class="p-4 bg-gray-50 dark:bg-gray-700 rounded">
        <h3 class="text-xl font-semibold mb-2">On-Page SEO</h3>
        <div class="chart-container"><canvas id="chart-onpage-seo"></canvas></div>
      </div>
      <div class="p-4 bg-gray-50 dark:bg-gray-700 rounded">
        <h3 class="text-xl font-semibold mb-2">Performance & Core Web Vitals</h3>
        <div class="chart-container"><canvas id="chart-performance"></canvas></div>
      </div>
      <div class="p-4 bg-gray-50 dark:bg-gray-700 rounded">
        <h3 class="text-xl font-semibold mb-2">Security</h3>
        <div class="chart-container"><canvas id="chart-security"></canvas></div>
      </div>
      <div class="p-4 bg-gray-50 dark:bg-gray-700 rounded">
        <h3 class="text-xl font-semibold mb-2">Mobile & Responsiveness</h3>
        <div class="chart-container"><canvas id="chart-mobile"></canvas></div>
      </div>
      <div class="p-4 bg-gray-50 dark:bg-gray-700 rounded">
        <h3 class="text-xl font-semibold mb-2">Accessibility & Usability</h3>
        <div class="chart-container"><canvas id="chart-usability"></canvas></div>
      </div>
      <div class="p-4 bg-gray-50 dark:bg-gray-700 rounded">
        <h3 class="text-xl font-semibold mb-2">Backlinks & Authority</h3>
        <div class="chart-container"><canvas id="chart-backlinks"></canvas></div>
      </div>
      <div class="p-4 bg-gray-50 dark:bg-gray-700 rounded">
        <h3 class="text-xl font-semibold mb-2">Content & Keywords</h3>
        <div class="chart-container"><canvas id="chart-content"></canvas></div>
      </div>
      <div class="p-4 bg-gray-50 dark:bg-gray-700 rounded">
        <h3 class="text-xl font-semibold mb-2">Competitor Comparison</h3>
        <div class="chart-container"><canvas id="chart-competitor"></canvas></div>
      </div>
    </div>

    <!-- Advanced Features -->
    <div class="p-4 bg-gray-50 dark:bg-gray-700 rounded space-y-4">
      <h3 class="text-xl font-semibold mb-2">Advanced Features</h3>
      <ul class="list-disc pl-6 space-y-1">
        <li id="py-integration">#Python Audit Integration Link</a></li>
        <li id="recommendations">Recommendations: <span id="recommendations-list"></span></li>
        <li id="weak-areas">Weak Areas: <span id="weak-areas-list"></span></li>
        <li><Download Certified PDF Report</a></li>
        <li id="audit-history">Historical audits trend chart:</li>
        <div class="chart-container"><canvas id="chart-history"></canvas></div>
      </ul>
    </div>

  </section>

</main>

<footer class="bg-blue-600 dark:bg-blue-800 text-white p-4 text-center">
  &copy; 2025 FF Tech Elite | Ultimate Website Audit
</footer>

<script>
// Dark Mode
document.getElementById('toggle-dark').addEventListener('click', ()=>{
  document.documentElement.classList.toggle('dark');
});

// Audit Counter and Subscription Limit
let auditCount = 0;
const maxFreeAudits = 5;

// Charts
let historyChart;

document.getElementById('run-audit').addEventListener('click', async ()=>{
  const url = document.getElementById('audit-url').value.trim();
  if(!url){ alert("Enter a valid URL"); return; }

  auditCount++;
  if(auditCount > maxFreeAudits){
    document.getElementById('subscription-alert').classList.remove('hidden');
    return;
  }

  document.getElementById('audit-results').classList.remove('hidden');
  document.getElementById('audit-status').innerText = `Running audit for ${url}...`;

  try {
    const res = await fetch(`/api/audit?url=${encodeURIComponent(url)}`);
    const data = await res.json();
    const audit = data.audit;

    // Executive summary
    document.getElementById('executive-summary').innerText = audit.executive_summary;

    // Update Python Integration Link
    document.getElementById('py-integration').querySelector('a').href = `/run-audit?url=${encodeURIComponent(url)}`;

    // Recommendations
    const recoList = Object.values(audit.recommendations).join(", ");
    document.getElementById('recommendations-list').innerText = recoList;

    // Weak areas
    document.getElementById('weak-areas-list').innerText = audit.weaknesses.join(", ");

    // PDF link
    document.getElementById('download-pdf').href = `/api/audit/pdf?url=${encodeURIComponent(url)}`;

    // Charts
    const chartData = [
      { id:'chart-overall-score', label:'Overall', value:audit.site_health_score },
      { id:'chart-technical-seo', label:'Technical SEO', value:audit.metrics_summary.seo_score },
      { id:'chart-onpage-seo', label:'On-Page SEO', value:audit.metrics_summary.accessibility_score },
      { id:'chart-performance', label:'Performance', value:audit.metrics_summary.performance_score },
      { id:'chart-security', label:'Security', value:audit.metrics_summary.security_score },
      { id:'chart-mobile', label:'Mobile', value:audit.metrics_summary.mobile_friendly ? 100 : 0 },
      { id:'chart-usability', label:'Accessibility', value:audit.metrics_summary.accessibility_score },
      { id:'chart-backlinks', label:'Backlinks', value:0 },
      { id:'chart-content', label:'Content', value:audit.metrics_summary.pages_crawled },
      { id:'chart-competitor', label:'Competitor', value:audit.site_health_score }
    ];

    chartData.forEach(c=>{
      const ctx = document.getElementById(c.id).getContext('2d');
      new Chart(ctx,{
        type:'bar',
        data:{ labels:[c.label], datasets:[{ label:c.label, data:[c.value], backgroundColor:'rgba(37,99,235,0.7)' }] },
        options:{ responsive:true, maintainAspectRatio:false, scales:{ y:{ min:0, max:100 } } }
      });
    });

    // History chart
    const histRes = await fetch(`/api/history?url=${encodeURIComponent(url)}&limit=12`);
    const histData = await histRes.json();
    const labels = histData.points.map(p=>new Date(p.t).toLocaleDateString());
    const scores = histData.points.map(p=>p.score);
    const ctxHist = document.getElementById('chart-history').getContext('2d');
    if(historyChart){
      historyChart.data.labels = labels;
      historyChart.data.datasets[0].data = scores;
      historyChart.update();
    } else {
      historyChart = new Chart(ctxHist,{
        type:'line',
        data:{ labels, datasets:[{ data:scores, borderColor:'#2563EB', backgroundColor:'rgba(37,99,235,0.2)', tension:.4, fill:true }] },
        options:{ responsive:true, maintainAspectRatio:false, scales:{ y:{ min:0, max:100 } } }
      });
    }

    document.getElementById('audit-status').innerText = `Audit completed for ${audit.website.url}. Score ${audit.site_health_score}% (Grade ${audit.grade}).`;

  } catch(e){
    console.error(e);
    document.getElementById('audit-status').innerText = 'Audit failed. Please try again.';
  }
});

// Subscription Button Placeholder
document.getElementById('subscribe-btn').addEventListener('click',()=>{
  alert("Integrate Stripe/PayPal backend here.");
});

// Send Login Link
document.getElementById('send-link').addEventListener('click', async ()=>{
  const email = document.getElementById('email-login').value.trim();
  if(!email){ alert("Enter valid email"); return; }
  const res = await fetch('/auth/send-link',{ method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({email}) });
  const data = await res.json();
  document.getElementById('login-status').innerText = data.message || 'Check your email for login link.';
});
</script>
</body>
</html>
