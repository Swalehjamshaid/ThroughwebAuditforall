<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Throughweb Audit AI | Advanced SEO Scanner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        /* Smooth progress bar transition */
        #progressFill { transition: width 0.4s ease-out; }
    </style>
</head>
<body class="bg-slate-900 text-white p-4 md:p-10 font-sans">
    <div class="max-w-4xl mx-auto bg-slate-800 p-6 md:p-8 rounded-xl shadow-2xl border border-slate-700">
        <div class="flex items-center gap-3 mb-6">
            <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center font-bold text-xl shadow-lg shadow-blue-900/50">T</div>
            <h1 class="text-2xl md:text-3xl font-bold text-blue-400">Throughweb Audit AI</h1>
        </div>

        <div class="flex flex-col md:flex-row gap-4 mb-4">
            <input type="text" id="url" placeholder="Enter URL (e.g., google.com)" 
                   class="flex-1 p-3 rounded bg-slate-700 border border-slate-600 focus:ring-2 focus:ring-blue-500 focus:outline-none text-white transition-all">
            <button onclick="runAudit()" id="btn" 
                    class="bg-blue-600 px-8 py-3 rounded font-bold hover:bg-blue-500 transition-all active:scale-95 disabled:opacity-50">
                Analyze Website
            </button>
        </div>

        <div id="progressContainer" class="hidden mb-8">
            <div class="flex justify-between mb-2 text-xs text-slate-400">
                <span id="statusText">Scanning 45+ security & SEO metrics...</span>
                <span id="progressPercent">0%</span>
            </div>
            <div class="w-full bg-slate-700 rounded-full h-2.5 overflow-hidden">
                <div id="progressFill" class="bg-blue-500 h-2.5 w-0 shadow-[0_0_10px_#3b82f6]"></div>
            </div>
        </div>

        <div id="errorBox" class="hidden mb-6 p-4 bg-red-900/30 border border-red-500/50 text-red-200 rounded-lg text-sm"></div>

        <div id="results" class="hidden fade-in">
            <div class="grid grid-cols-2 gap-4 mb-6">
                <div class="bg-slate-700/50 p-6 rounded-lg text-center border border-slate-600">
                    <p class="text-xs text-slate-400 uppercase tracking-widest mb-1">Grade</p>
                    <p id="grade" class="text-5xl font-black text-green-400"></p>
                </div>
                <div class="bg-slate-700/50 p-6 rounded-lg text-center border border-slate-600">
                    <p class="text-xs text-slate-400 uppercase tracking-widest mb-1">Health Score</p>
                    <p id="score" class="text-5xl font-black text-blue-400"></p>
                </div>
            </div>

            <a id="dl" href="#" target="_blank" class="block text-center bg-blue-600/10 border border-blue-600/30 text-blue-400 py-3 rounded-lg mb-8 hover:bg-blue-600 hover:text-white transition-all font-semibold">
                ðŸ“¥ Download Detailed PDF Report
            </a>
            
            <h3 class="text-xl font-bold text-slate-200 mb-4 border-b border-slate-700 pb-2">Technical Audit Metrics</h3>
            <div id="metricsTable" class="grid grid-cols-1 md:grid-cols-2 gap-3 text-[11px]"></div>
        </div>
    </div>

    <script>
        let progressInterval;

        function updateProgress(start) {
            const fill = document.getElementById('progressFill');
            const percentText = document.getElementById('progressPercent');
            const statusText = document.getElementById('statusText');
            let width = 0;

            progressInterval = setInterval(() => {
                if (width >= 95) {
                    clearInterval(progressInterval);
                    statusText.innerText = "Finalizing report...";
                } else {
                    width += Math.random() * 5;
                    if(width > 95) width = 95;
                    fill.style.width = width + '%';
                    percentText.innerText = Math.floor(width) + '%';
                    
                    if(width > 30) statusText.innerText = "Checking Security SSL...";
                    if(width > 60) statusText.innerText = "Analyzing 45+ Meta Tags...";
                }
            }, 600);
        }

        async function runAudit() {
            const urlInput = document.getElementById('url');
            const btn = document.getElementById('btn');
            const results = document.getElementById('results');
            const errorBox = document.getElementById('errorBox');
            const progressContainer = document.getElementById('progressContainer');
            const metricsTable = document.getElementById('metricsTable');

            let url = urlInput.value.trim();
            if(!url) return;

            // Reset UI
            btn.disabled = true;
            btn.innerText = "Running...";
            errorBox.classList.add('hidden');
            results.classList.add('hidden');
            progressContainer.classList.remove('hidden');
            document.getElementById('progressFill').style.width = '0%';
            
            updateProgress();

            try {
                const res = await fetch('/audit', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({url: url})
                });

                const result = await res.json();
                if (!res.ok) throw new Error(result.detail || "Connection Timeout");

                // Audit Success
                clearInterval(progressInterval);
                document.getElementById('progressFill').style.width = '100%';
                document.getElementById('progressPercent').innerText = '100%';

                setTimeout(() => {
                    document.getElementById('grade').innerText = result.data.grade;
                    document.getElementById('score').innerText = result.data.score;
                    document.getElementById('dl').href = `/download/${result.id}`;
                    
                    let html = "";
                    for (const [k, v] of Object.entries(result.data.metrics)) {
                        html += `
                            <div class="bg-slate-700/30 p-3 rounded flex justify-between border border-slate-700/50">
                                <span class="text-slate-400 font-medium uppercase tracking-tight">${k}</span>
                                <span class="font-bold text-blue-200">${v}</span>
                            </div>`;
                    }
                    metricsTable.innerHTML = html;
                    
                    progressContainer.classList.add('hidden');
                    results.classList.remove('hidden');
                }, 500);

            } catch (err) {
                clearInterval(progressInterval);
                progressContainer.classList.add('hidden');
                errorBox.innerText = `Error: ${err.message}`;
                errorBox.classList.remove('hidden');
            } finally {
                btn.disabled = false;
                btn.innerText = "Analyze Website";
            }
        }
    </script>
</body>
</html>
