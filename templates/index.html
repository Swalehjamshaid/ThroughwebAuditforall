<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FF Tech — Elite AI Website Audit Report</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; background: linear-gradient(to bottom right, #f8fafc, #e0e7ff); color: #1e293b; }
    .page { @apply bg-white shadow-2xl rounded-3xl p-10 lg:p-16 my-16; }
    .grade-display { font-size: clamp(100px, 20vw, 240px); font-weight: 900; }
    canvas { max-height: 450px; width: 100% !important; }
    @media print {
      body { background: white; }
      .no-print { display: none !important; }
      .page { page-break-after: always; box-shadow: none; margin: 0; padding: 40px; }
    }
    .high { @apply bg-red-50 border-l-8 border-red-500; }
    .med { @apply bg-amber-50 border-l-8 border-amber-500; }
    .gap-bad { @apply text-red-600 font-black; }
    .gap-good { @apply text-emerald-600 font-black; }
    .roadmap-box { @apply bg-gradient-to-r from-sky-50 to-indigo-50 border-l-8 border-indigo-600 p-10 rounded-r-3xl shadow-xl my-12 text-lg; }
  </style>
</head>
<body class="min-h-screen">

  <div class="max-w-7xl mx-auto px-6 py-12">
    <!-- PDF Export Button -->
    <button onclick="window.print()" class="no-print fixed bottom-8 right-8 z-50 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white px-10 py-6 rounded-full shadow-2xl font-black text-xl flex items-center gap-4 transition-all hover:scale-105">
      <i class="fas fa-file-pdf text-3xl"></i> Export Certified PDF
    </button>

    <div id="reportContent" class="space-y-32"></div>
  </div>

  <script>
    // Fetch real data from Python backend
    async function loadReport() {
      try {
        const res = await fetch('/report-data');
        if (!res.ok) throw new Error();
        const data = await res.json();
        renderReport(data);
      } catch (err) {
        // Beautiful demo data (fallback)
        const data = {
          site_url: "https://example.com",
          overall_score: 82,
          grade: "B+",
          exec_summary: "Your website demonstrates strong technical health with an overall score of 82/100 (B+). The primary growth blocker is mobile performance with LCP at 3.2s—causing an estimated 18–24% revenue leak due to higher bounce rates. Security posture is excellent with full header compliance. Compared to your main competitor, you are slightly slower on load times but lead in SEO depth.\n\nTop 3 Urgent Fixes:\n1. Optimize images and defer non-critical JS\n2. Enable browser caching\n3. Expand thin content pages\n\nImmediate action will restore trust and unlock significant revenue growth.",
          category_scores: [
            { area: "Security", weight: "28%", score: 94 },
            { area: "Performance", weight: "27%", score: 68 },
            { area: "SEO", weight: "23%", score: 85 },
            { area: "UX", weight: "12%", score: 91 },
            { area: "Content", weight: "10%", score: 76 }
          ],
          priority_matrix: [
            { priority: "HIGH", impact: "Revenue", effort: "Medium", fix: "Optimize LCP below 2.5s" },
            { priority: "HIGH", impact: "Trust", effort: "Low", fix: "Add HSTS & CSP headers" },
            { priority: "MED", impact: "SEO", effort: "Low", fix: "Fix missing meta descriptions" }
          ],
          competitor_table: [
            { metric: "Mobile LCP", you: "3.2s", competitor: "1.9s", gap: "❌ Slower" },
            { metric: "Overall Score", you: "82", competitor: "88", gap: "❌ Lower" },
            { metric: "Security Score", you: "94", competitor: "91", gap: "✅ Stronger" }
          ],
          weak_areas: ["Slow Mobile LCP", "Thin Content", "Missing Alt Texts"],
          trend_data: { labels: ["Jul", "Aug", "Sep", "Oct", "Nov", "Dec"], values: [72, 75, 78, 79, 81, 82] },
          radar_data: { labels: ["Security","Performance","SEO","UX","Content"], your: [94,68,85,91,76], competitor: [91,82,88,90,80] },
          cwv_data: { lcp: 3200, cls: 0.09, tbt: 380, lcp_target: 2500, cls_target: 0.1, tbt_target: 300 }
        };
        renderReport(data);
      }
    }

    function renderReport(data) {
      const content = document.getElementById('reportContent');
      content.innerHTML = `
        <!-- Page 1: Cover -->
        <div class="page text-center bg-gradient-to-br from-indigo-50 to-purple-50">
          <div class="grade-display text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 to-purple-600 mb-8">${data.grade}</div>
          <h1 class="text-5xl lg:text-7xl font-black mb-8">FF Tech Certified Audit Report</h1>
          <p class="text-3xl font-bold text-indigo-800 mb-6">${data.site_url}</p>
          <p class="text-xl text-gray-700 mb-12">Generated on ${new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</p>
          <div class="bg-white/80 backdrop-blur rounded-3xl p-8 inline-block shadow-2xl">
            <img src="https://dummyimage.com/400x120/4f46e5/ffffff&text=FF+Tech+Elite+Certified" alt="FF Tech Certified Seal" class="mx-auto">
          </div>
        </div>

        <!-- Page 2: Executive Summary + Radar Chart -->
        <div class="page">
          <h2 class="text-5xl font-black border-b-8 border-indigo-600 pb-6 mb-12">AI Executive Summary</h2>
          <div class="bg-gradient-to-r from-indigo-50 to-purple-50 p-12 rounded-3xl border-l-8 border-indigo-600 mb-16 text-xl leading-relaxed shadow-xl">
            ${data.exec_summary.replace(/\n/g, '<br><br>')}
          </div>

          <div class="grid lg:grid-cols-2 gap-16 items-center">
            <div>
              <h2 class="text-4xl font-black mb-8">Global Health Score Breakdown</h2>
              <div class="overflow-x-auto">
                <table class="w-full border-collapse rounded-3xl overflow-hidden shadow-2xl">
                  <thead class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white">
                    <tr><th class="p-8 text-left text-xl font-black">Area</th><th class="p-8 text-center text-xl">Weight</th><th class="p-8 text-right text-xl font-black">Score</th></tr>
                  </thead>
                  <tbody>
                    ${data.category_scores.map(c => `
                      <tr class="${c.score < 75 ? 'bg-red-50' : c.score < 85 ? 'bg-amber-50' : 'bg-emerald-50'}">
                        <td class="p-8 font-bold text-lg">${c.area}</td>
                        <td class="p-8 text-center text-lg">${c.weight}</td>
                        <td class="p-8 text-right text-4xl font-black ${c.score >= 90 ? 'text-emerald-600' : c.score >= 75 ? 'text-amber-600' : 'text-red-600'}">${c.score}/100</td>
                      </tr>
                    `).join('')}
                    <tr class="bg-gradient-to-r from-indigo-800 to-purple-800 text-white">
                      <td class="p-8 font-black text-2xl">Overall</td>
                      <td class="p-8 font-black text-2xl">100%</td>
                      <td class="p-8 text-right font-black text-6xl">${data.overall_score}/100 (${data.grade})</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
            <div class="bg-gradient-to-br from-gray-50 to-indigo-50 rounded-3xl p-12 shadow-2xl">
              <h3 class="text-3xl font-bold text-center mb-10">Category Strength Radar</h3>
              <canvas id="radarChart"></canvas>
            </div>
          </div>
        </div>

        <!-- Page 3: Priority Matrix + Competitor + Trend -->
        <div class="page">
          <h2 class="text-5xl font-black border-b-8 border-red-600 pb-6 mb-12">Priority Fix Matrix</h2>
          <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8 mb-16">
            ${data.priority_matrix.map(r => `
              <div class="${r.priority === 'HIGH' ? 'high' : 'med'} p-8 rounded-3xl shadow-xl">
                <div class="text-3xl font-black mb-4 ${r.priority === 'HIGH' ? 'text-red-600' : 'text-amber-600'}">${r.priority} Priority</div>
                <div class="text-xl font-bold mb-2">Impact: ${r.impact}</div>
                <div class="text-lg mb-4">Effort: ${r.effort}</div>
                <div class="text-lg leading-relaxed">${r.fix}</div>
              </div>
            `).join('')}
          </div>

          <div class="grid lg:grid-cols-2 gap-16">
            <div>
              <h2 class="text-4xl font-black border-b-8 border-blue-600 pb-6 mb-12">Competitor Gap Analysis</h2>
              <table class="w-full border-collapse rounded-3xl overflow-hidden shadow-2xl">
                <thead class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white">
                  <tr><th class="p-8 text-left text-xl font-black">Metric</th><th class="p-8 text-xl">You</th><th class="p-8 text-xl">Competitor</th><th class="p-8 text-left text-xl">Gap</th></tr>
                </thead>
                <tbody>
                  ${data.competitor_table.map(r => `
                    <tr class="${r.gap.includes('❌') ? 'gap-bad' : 'gap-good'}">
                      <td class="p-8 font-bold text-lg">${r.metric}</td>
                      <td class="p-8 text-2xl">${r.you}</td>
                      <td class="p-8 text-xl">${r.competitor}</td>
                      <td class="p-8 text-4xl font-black">${r.gap}</td>
                    </tr>
                  `).join('')}
                </tbody>
              </table>
            </div>
            <div class="bg-gradient-to-br from-gray-50 to-indigo-50 rounded-3xl p-12 shadow-2xl">
              <h3 class="text-3xl font-bold text-center mb-10">Health Score Trend</h3>
              <canvas id="trendChart"></canvas>
            </div>
          </div>
        </div>

        <!-- Page 4: Core Web Vitals + Risks + Roadmap -->
        <div class="page">
          <h2 class="text-5xl font-black border-b-8 border-amber-600 pb-6 mb-12">Core Web Vitals Gauges</h2>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-12 mb-16 text-center">
            <div class="bg-white rounded-3xl p-10 shadow-xl"><canvas id="lcpGauge"></canvas><p class="mt-6 text-2xl font-bold">LCP: ${data.cwv_data.lcp}ms</p></div>
            <div class="bg-white rounded-3xl p-10 shadow-xl"><canvas id="clsGauge"></canvas><p class="mt-6 text-2xl font-bold">CLS: ${data.cwv_data.cls}</p></div>
            <div class="bg-white rounded-3xl p-10 shadow-xl"><canvas id="tbtGauge"></canvas><p class="mt-6 text-2xl font-bold">TBT: ${data.cwv_data.tbt}ms</p></div>
          </div>

          <h2 class="text-5xl font-black border-b-8 border-red-600 pb-6 mb-12">Critical Risk Areas</h2>
          <div class="flex flex-wrap justify-center gap-10 mb-16">
            ${data.weak_areas.map(a => `
              <div class="px-12 py-8 bg-red-100 text-red-800 rounded-3xl text-2xl font-black border-8 border-red-300 shadow-2xl flex items-center">
                <i class="fas fa-exclamation-triangle mr-6 text-4xl"></i>${a}
              </div>
            `).join('')}
          </div>

          <h2 class="text-5xl font-black border-b-8 border-emerald-600 pb-6 mb-12">30-60-90 Day Roadmap</h2>
          <div class="grid md:grid-cols-3 gap-12">
            <div class="roadmap-box">
              <strong class="text-3xl block mb-6">30 Days: Restore Trust & Speed</strong>
              Security headers + LCP optimization → Reduce bounce by 25%
            </div>
            <div class="roadmap-box">
              <strong class="text-3xl block mb-6">60 Days: Drive Traffic</strong>
              SEO + content depth → 40% organic growth
            </div>
            <div class="roadmap-box">
              <strong class="text-3xl block mb-6">90 Days: Revenue Lift</strong>
              UX + conversion → 18-30% sales increase
            </div>
          </div>
        </div>
      `;

      initCharts(data);
    }

    function initCharts(data) {
      // Radar Chart
      new Chart(document.getElementById('radarChart'), {
        type: 'radar',
        data: {
          labels: data.radar_data.labels,
          datasets: [
            { label: 'Your Site', data: data.radar_data.your, backgroundColor: 'rgba(79,70,229,0.2)', borderColor: '#4f46e5', pointBackgroundColor: '#4f46e5', borderWidth: 4 },
            { label: 'Competitor', data: data.radar_data.competitor, backgroundColor: 'rgba(34,197,94,0.2)', borderColor: '#22c55e', pointBackgroundColor: '#22c55e', borderWidth: 4 }
          ]
        },
        options: { responsive: true, scales: { r: { min: 0, max: 100, ticks: { stepSize: 20 } } } }
      });

      // Trend Line
      new Chart(document.getElementById('trendChart'), {
        type: 'line',
        data: {
          labels: data.trend_data.labels,
          datasets: [{ label: 'Score', data: data.trend_data.values, borderColor: '#4f46e5', backgroundColor: 'rgba(79,70,229,0.1)', tension: 0.4, fill: true }]
        },
        options: { responsive: true, plugins: { legend: { display: false } }, scales: { y: { min: 0, max: 100 } } }
      });

      // Gauges
      const gauge = (id, value, max, target, unit = '') => {
        const percent = (value / max) * 100;
        const good = value <= target;
        new Chart(document.getElementById(id), {
          type: 'doughnut',
          data: { datasets: [{ data: [percent, 100-percent], backgroundColor: [good ? '#22c55e' : '#ef4444', '#e5e7eb'], cutout: '80%' }] },
          options: { responsive: true, plugins: { legend: { display: false }, tooltip: { enabled: false } } },
          plugins: [{
            afterDraw: chart => {
              const ctx = chart.ctx;
              ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
              const x = chart.width / 2, y = chart.height / 2;
              ctx.font = 'bold 48px Inter'; ctx.fillStyle = good ? '#22c55e' : '#ef4444';
              ctx.fillText(value + unit, x, y - 20);
              ctx.font = '20px Inter'; ctx.fillStyle = '#6b7280';
              ctx.fillText(good ? 'Good' : 'Needs Work', x, y + 30);
            }
          }]
        });
      };

      gauge('lcpGauge', data.cwv_data.lcp, 5000, data.cwv_data.lcp_target, 'ms');
      gauge('clsGauge', data.cwv_data.cls * 1000, 500, data.cwv_data.cls_target * 1000);
      gauge('tbtGauge', data.cwv_data.tbt, 1000, data.cwv_data.tbt_target, 'ms');
    }

    window.onload = loadReport;
  </script>
</body>
</html>
