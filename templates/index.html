
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>FF TECH ELITE | Enterprise Web Auditor</title>

  <!-- Tailwind CSS -->
  https://cdn.tailwindcss.com</script>
  <!-- Font Awesome -->
  https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css

  <!-- Tailwind custom theme -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            base: {
              900: "#0b1220",   /* page background */
              800: "#0f172a",   /* panels */
              700: "#111827",
            },
            brand: {
              50:  "#e6fff5",
              100: "#caffea",
              200: "#a5f3d5",
              300: "#6ee7b7",
              400: "#34d399",
              500: "#10b981",   /* emerald */
              600: "#0ea373",
              700: "#0b8a61",
            },
          },
          boxShadow: {
            glow: "0 30px 120px -20px rgba(16,185,129,.25)",
            panel: "0 25px 60px -12px rgba(0,0,0,.55)",
          },
          backgroundImage: {
            'diagonal': "radial-gradient(1000px 600px at 80% 5%, rgba(16,185,129,.18), transparent 60%), radial-gradient(900px 400px at 0% 100%, rgba(59,130,246,.13), transparent 60%)",
            'mesh': "radial-gradient(circle at 20% 20%, rgba(16,185,129,.08), transparent 35%), radial-gradient(circle at 80% 10%, rgba(59,130,246,.08), transparent 35%), radial-gradient(circle at 50% 80%, rgba(244,114,182,.08), transparent 45%)",
          },
          keyframes: {
            shimmer: { '0%': { backgroundPosition: '0% 0%' }, '100%': { backgroundPosition: '200% 0%' } },
            rise: { '0%': { transform: 'translateY(6px)', opacity: 0 }, '100%': { transform: 'translateY(0)', opacity: 1 } },
          },
          animation: {
            shimmer: 'shimmer 2.4s linear infinite',
            rise: 'rise .6s ease forwards',
          }
        }
      }
    }
  </script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap');

    /* Page foundation */
    body {
      font-family: 'Plus Jakarta Sans', system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, 'Noto Sans', 'Liberation Sans', sans-serif;
      background:
        var(--mesh, none),
        var(--diagonal, none),
        radial-gradient(1200px 750px at 70% 0%, rgba(255,255,255,.06), transparent 60%),
        linear-gradient(180deg, #0b1220 0%, #0b1220 100%);
      --mesh: radial-gradient(circle at 25% 30%, rgba(255,255,255,.06), transparent 30%);
      --diagonal: radial-gradient(900px 600px at 90% 0%, rgba(16,185,129,.15), transparent 55%);
      color: #f8fafc;
      min-height: 100vh;
    }

    /* Premium glass panel */
    .glass-panel {
      background: linear-gradient(180deg, rgba(17,24,39,.75), rgba(17,24,39,.65));
      backdrop-filter: blur(16px);
      border: 1px solid rgba(255,255,255,.08);
      box-shadow: var(--panel-shadow, 0 25px 60px -12px rgba(0,0,0,.55));
      border-radius: 1.5rem;
    }

    /* Gauge animation */
    .gauge-animation { transition: stroke-dashoffset 1.8s cubic-bezier(.34,1.56,.64,1); }

    /* Utility */
    .rotate-180 { transform: rotate(180deg); }

    /* Gradient underline for hero title */
    .underline-gradient {
      position: relative;
    }
    .underline-gradient::after {
      content: "";
      position: absolute;
      left: 0;
      bottom: -6px;
      width: 160px;
      height: 4px;
      border-radius: 999px;
      background: linear-gradient(90deg, #10b981, #60a5fa, #f472b6);
      box-shadow: 0 0 20px rgba(16,185,129,.35);
    }
  </style>
</head>
<body class="bg-base-900">

  <!-- NAVBAR -->
  <nav class="glass-panel sticky top-0 z-50 border-b border-white/10 px-6 lg:px-10 py-4">
    <div class="max-w-7xl mx-auto flex flex-wrap gap-4 items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 bg-brand-500 rounded-xl flex items-center justify-center shadow-glow">
          <i class="fa-solid fa-shield-halved text-base-900 text-xl"></i>
        </div>
        <h1 class="text-xl lg:text-2xl font-extrabold tracking-tight">
          FF TECH <span class="text-brand-400">ELITE</span>
        </h1>
        <span class="ml-2 text-[11px] tracking-wide font-bold uppercase bg-white/10 px-2 py-1 rounded">v3</span>
      </div>

      <div class="flex items-center gap-3">
        <button id="sampleDomain" class="bg-white/10 hover:bg-white/20 px-3 py-2 rounded-lg text-xs font-bold transition">
          Use Sample: haier.com.pk
        </button>
        <button id="copyLink" class="bg-white/10 hover:bg-white/20 px-3 py-2 rounded-lg text-xs font-bold transition">
          Copy Share Link
        </button>
        <div id="engineStatus" class="hidden md:flex items-center gap-3 bg-white/5 px-4 py-2 rounded-full border border-white/10">
          <span class="relative flex h-3 w-3">
            <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-brand-400 opacity-75"></span>
            <span class="relative inline-flex rounded-full h-3 w-3 bg-brand-500"></span>
          </span>
          <span class="text-[11px] font-bold tracking-widest opacity-80 uppercase">Chromium Engine Active</span>
        </div>
      </div>
    </div>
  </nav>

  <!-- MAIN -->
  <main class="max-w-7xl mx-auto px-6 lg:px-10 py-10 lg:py-14">

    <!-- HERO -->
    <section class="mb-12 lg:mb-16">
      <div class="glass-panel p-8 lg:p-12 shadow-panel">
        <div class="mb-6 lg:mb-8">
          <h2 class="underline-gradient text-4xl lg:text-5xl font-extrabold tracking-tight">Enterprise Web Auditor</h2>
          <p class="text-slate-300 mt-3">
            A precision engine to audit <span class="text-brand-400 font-semibold">Performance</span>, <span class="text-brand-400 font-semibold">SEO</span>, <span class="text-brand-400 font-semibold">UX</span>, and <span class="text-brand-400 font-semibold">Security</span> using a real Chromium browser.
          </p>
          <div class="mt-4 flex flex-wrap gap-2">
            <span class="text-[11px] font-bold uppercase bg-white/10 px-3 py-1 rounded border border-white/10">Core Web Vitals</span>
            <span class="text-[11px] font-bold uppercase bg-white/10 px-3 py-1 rounded border border-white/10">Headers & Mixed Content</span>
            <span class="text-[11px] font-bold uppercase bg-white/10 px-3 py-1 rounded border border-white/10">Structured Data</span>
            <span class="text-[11px] font-bold uppercase bg-white/10 px-3 py-1 rounded border border-white/10">PDF Export</span>
          </div>
        </div>

        <!-- FORM -->
        <form id="auditForm" class="space-y-6">
          <div class="grid md:grid-cols-3 gap-4">
            <div class="md:col-span-2 relative">
              <label for="url" class="absolute left-4 -top-2 text-[10px] px-2 py-[2px] rounded bg-white/10 border border-white/10 uppercase tracking-widest">Target URL</label>
              <i class="fa-solid fa-link absolute left-4 top-1/2 -translate-y-1/2 text-brand-500/60"></i>
              <input type="url" id="url" placeholder="https://your-website.com" required
                class="w-full bg-base-800/60 border border-white/10 rounded-2xl pl-12 pr-6 py-5 outline-none focus:border-brand-400/60 focus:ring-4 focus:ring-brand-400/10 transition text-lg" />
            </div>
            <div>
              <label for="mode" class="block text-[10px] mb-2 px-2 py-[2px] rounded bg-white/10 border border-white/10 uppercase tracking-widest">Engine</label>
              <select id="mode"
                class="w-full bg-base-800/60 border border-white/10 rounded-2xl px-5 py-5 outline-none focus:border-brand-400/60 transition font-semibold">
                <option value="desktop">Desktop Engine</option>
                <option value="mobile">Mobile Engine</option>
              </select>
            </div>
          </div>

          <div class="grid grid-cols-2 gap-3">
            <button type="submit" id="submitBtn"
              class="w-full bg-brand-500 hover:bg-brand-400 text-base-900 font-black py-5 rounded-2xl transition shadow-glow flex items-center justify-center gap-3 text-lg">
              <i class="fa-solid fa-magnifying-glass-chart"></i> EXECUTE FULL AUDIT
            </button>
            <button type="button" id="resetBtn"
              class="w-full bg-white/10 hover:bg-white/20 text-white font-black py-5 rounded-2xl transition flex items-center justify-center gap-3 text-lg">
              <i class="fa-solid fa-broom"></i> RESET
            </button>
          </div>
        </form>
      </div>
    </section>

    <!-- LOADER (overlay style) -->
    <div id="loader" class="hidden fixed inset-0 z-40 bg-base-900/80 backdrop-blur-sm flex items-center justify-center">
      <div class="glass-panel w-[90%] max-w-xl p-8 shadow-panel">
        <div class="flex items-center gap-4">
          <div class="w-14 h-14 border-4 border-brand-500/20 border-t-brand-500 rounded-full animate-spin"></div>
          <div>
            <h3 class="text-xl font-bold">Simulating User Behavior...</h3>
            <p class="text-slate-300 mt-[2px] text-sm">Extracting Core Web Vitals via Playwright CDP</p>
          </div>
        </div>
        <div class="mt-5 h-1.5 rounded-full bg-white/10 overflow-hidden">
          <div class="h-full w-1/3 bg-brand-500/50 animate-[shimmer_1.8s_linear_infinite]"></div>
        </div>
      </div>
    </div>

    <!-- RESULTS -->
    <section id="results" class="hidden space-y-10 animate-rise">

      <!-- KPI cards -->
      <div class="grid lg:grid-cols-4 gap-6">
        <!-- Health Score -->
        <div class="glass-panel rounded-[2rem] p-8 lg:p-10 flex flex-col items-center justify-center relative overflow-hidden shadow-panel">
          <h3 class="text-xs font-black uppercase tracking-widest opacity-60 mb-6">Health Score</h3>
          <div class="relative w-40 h-40">
            <svg class="w-full h-full -rotate-90" viewBox="0 0 100 100">
              <circle cx="50" cy="50" r="45" fill="none" stroke="rgba(255,255,255,0.08)" stroke-width="8"></circle>
              <circle id="scoreCircle" cx="50" cy="50" r="45" fill="none" stroke="#10b981" stroke-width="8"
                      stroke-dasharray="283" stroke-dashoffset="283" stroke-linecap="round" class="gauge-animation"></circle>
            </svg>
            <div class="absolute inset-0 flex flex-col items-center justify-center">
              <span id="scoreVal" class="text-5xl font-black">0</span>
              <span class="text-xs font-bold opacity-40 uppercase">Percent</span>
            </div>
          </div>
        </div>

        <!-- Pillars -->
        <div class="lg:col-span-3 grid grid-cols-2 md:grid-cols-4 gap-4">
          <div class="glass-panel rounded-2xl p-6 border-b-[3px] border-brand-500 shadow-panel">
            <i class="fa-solid fa-bolt text-brand-400 mb-3"></i>
            <p class="text-[11px] font-bold opacity-60 uppercase">Performance</p>
            <div id="perfPillar" class="text-3xl font-black mt-1">0%</div>
          </div>
          <div class="glass-panel rounded-2xl p-6 border-b-[3px] border-sky-500 shadow-panel">
            <i class="fa-solid fa-search text-sky-400 mb-3"></i>
            <p class="text-[11px] font-bold opacity-60 uppercase">SEO</p>
            <div id="seoPillar" class="text-3xl font-black mt-1">0%</div>
          </div>
          <div class="glass-panel rounded-2xl p-6 border-b-[3px] border-fuchsia-500 shadow-panel">
            <i class="fa-solid fa-wand-magic-sparkles text-fuchsia-400 mb-3"></i>
            <p class="text-[11px] font-bold opacity-60 uppercase">UX</p>
            <div id="uxPillar" class="text-3xl font-black mt-1">0%</div>
          </div>
          <div class="glass-panel rounded-2xl p-6 border-b-[3px] border-rose-500 shadow-panel">
            <i class="fa-solid fa-lock text-rose-400 mb-3"></i>
            <p class="text-[11px] font-bold opacity-60 uppercase">Security</p>
            <div id="secPillar" class="text-3xl font-black mt-1">0%</div>
          </div>
        </div>
      </div>

      <!-- Diagnostics -->
      <div class="glass-panel rounded-[2rem] overflow-hidden">
        <div class="px-8 lg:px-10 py-6 border-b border-white/10 flex flex-wrap gap-4 justify-between items-center bg-white/5">
          <div>
            <h3 class="text-lg lg:text-xl font-extrabold text-white">Advanced Diagnostics</h3>
            <p id="summaryDisplay" class="text-sm text-brand-400 font-semibold mt-1"></p>
          </div>
          <div class="flex gap-2">
            <button id="downloadPdf" class="bg-white/10 hover:bg-white/20 px-4 lg:px-6 py-3 rounded-xl text-sm font-bold transition flex items-center gap-2">
              <i class="fa-solid fa-file-export"></i> EXPORT REPORT
            </button>
          </div>
        </div>

        <div class="overflow-x-auto">
          <table class="w-full">
            <thead>
              <tr class="text-left text-[11px] lg:text-[10px] font-black uppercase tracking-[0.18em] opacity-40 border-b border-white/10">
                <th class="px-10 py-4 text-center">No</th>
                <th class="px-6 py-4">Diagnostic Checkpoint</th>
                <th class="px-6 py-4">Category</th>
                <th class="px-6 py-4">Health</th>
                <th class="px-6 py-4 text-right">Impact</th>
              </tr>
            </thead>
            <tbody id="metricBody" class="divide-y divide-white/10 font-medium"></tbody>
          </table>
        </div>
      </div>

      <!-- SEO AUDIT -->
      <div id="seoAuditSection" class="hidden glass-panel p-8 lg:p-10">
        <div class="flex flex-wrap gap-4 items-center justify-between">
          <h3 class="text-xl lg:text-2xl font-extrabold">SEO Audit Results</h3>
          <div id="seoScoreBadge" class="px-4 py-2 rounded-lg bg-brand-500/20 text-brand-300 font-bold">SEO Score: 0/100</div>
        </div>

        <!-- Section cards -->
        <div id="sectionScores" class="mt-6 grid grid-cols-2 md:grid-cols-4 gap-4"></div>

        <!-- Overview -->
        <div id="seoOverview" class="text-slate-300 mt-6"></div>

        <!-- Competitor Analysis -->
        <div id="competitorAnalysis" class="mt-8">
          <div class="flex items-center justify-between mb-3">
            <h4 class="text-lg lg:text-xl font-bold">Competitor Analysis</h4>
            <div class="flex gap-2">
              <button id="expandCompetitors" class="bg-white/10 hover:bg-white/20 px-3 py-2 rounded-lg text-xs font-bold">Expand All</button>
              <button id="collapseCompetitors" class="bg-white/10 hover:bg-white/20 px-3 py-2 rounded-lg text-xs font-bold">Collapse All</button>
            </div>
          </div>
          <!-- Panels appended dynamically -->
        </div>
      </div>
    </section>
  </main>

  <!-- FOOTER -->
  <footer class="max-w-7xl mx-auto px-6 lg:px-10 pb-12">
    <div class="glass-panel px-6 py-4 text-[12px] text-slate-400">
      <div class="flex items-center justify-between">
        <p>© FF TECH ELITE v3 — Real Browser Auditor</p>
        <p>PDF export powered by ReportLab · Playwright Chromium</p>
      </div>
    </div>
  </footer>

  <!-- SCRIPTS -->
  <script>
    const form = document.getElementById('auditForm');
    const results = document.getElementById('results');
    const loader = document.getElementById('loader');
    const seoAuditSection = document.getElementById('seoAuditSection');

    // Quick helpers
    document.getElementById('sampleDomain').onclick = () => {
      document.getElementById('url').value = 'https://www.haier.com.pk';
      window.scrollTo({ top: 0, behavior: 'smooth' });
    };

    document.getElementById('resetBtn').onclick = () => {
      document.getElementById('url').value = '';
      document.getElementById('mode').value = 'desktop';
      results.classList.add('hidden');
      seoAuditSection.classList.add('hidden');
      window.currentAuditData = null;
      window.scrollTo({ top: 0, behavior: 'smooth' });
    };

    document.getElementById('copyLink').onclick = async () => {
      try {
        const url = new URL(window.location.href);
        if (window.currentAuditData?.url) url.searchParams.set('target', window.currentAuditData.url);
        await navigator.clipboard.writeText(url.toString());
        alert('Share link copied!');
      } catch { alert('Unable to copy link'); }
    };

    // Submit
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const url = document.getElementById('url').value;
      const mode = document.getElementById('mode').value;

      loader.classList.remove('hidden');
      results.classList.add('hidden');
      seoAuditSection.classList.add('hidden');

      try {
        const response = await fetch('/audit', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ url, mode })
        });
        const data = await response.json();
        if (!response.ok) throw new Error(data.detail || 'Audit process failed');

        renderUI(data);
        window.currentAuditData = data;
      } catch (err) {
        alert("Critical Engine Error: " + err.message);
      } finally {
        loader.classList.add('hidden');
      }
    });

    function renderUI(data) {
      results.classList.remove('hidden');

      // Health score gauge
      const score = data.total_grade || 0;
      document.getElementById('scoreVal').innerText = score;
      const offset = 283 - (283 * score / 100);
      document.getElementById('scoreCircle').style.strokeDashoffset = offset;

      // Pillars
      document.getElementById('perfPillar').innerText = `${data.pillars.Performance}%`;
      document.getElementById('seoPillar').innerText = `${data.pillars.SEO}%`;
      document.getElementById('uxPillar').innerText = `${data.pillars.UX}%`;
      document.getElementById('secPillar').innerText = `${data.pillars.Security}%`;
      document.getElementById('summaryDisplay').innerText = data.summary || '';

      // Metrics table
      const tbody = document.getElementById('metricBody');
      tbody.innerHTML = '';
      data.metrics.forEach(m => {
        const tr = document.createElement('tr');
        tr.className = 'hover:bg-white/[.03] transition';

        let healthColor = 'text-brand-400';
        let statusIcon = 'fa-circle-check';
        if (m.score < 100) { healthColor = 'text-amber-400'; statusIcon = 'fa-circle-exclamation'; }
        if (m.score < 50)  { healthColor = 'text-rose-500';   statusIcon = 'fa-circle-xmark'; }

        tr.innerHTML = `
          <td class="px-10 py-4 text-center text-xs opacity-40 font-bold">${m.no}</td>
          <td class="px-6 py-4 text-white font-semibold">${m.name}</td>
          <td class="px-6 py-4"><span class="bg-white/8 px-3 py-1 rounded-lg text-[10px] uppercase font-black opacity-60 border border-white/10">${m.category}</span></td>
          <td class="px-6 py-4 font-black ${healthColor}">${m.score}%</td>
          <td class="px-6 py-4 text-right"><i class="fa-solid ${statusIcon} ${healthColor} text-lg"></i></td>
        `;
        tbody.appendChild(tr);
      });

      // SEO audit section
      if (data.seo_audit) {
        seoAuditSection.classList.remove('hidden');

        // Score badge
        document.getElementById('seoScoreBadge').innerText = `SEO Score: ${data.seo_audit.seo_score}/100`;

        // Section cards
        const scores = data.seo_audit.section_scores || {};
        const cards = [
          { label: 'On-Page SEO', value: scores['On-Page SEO'] || 0, color: 'brand' },
          { label: 'Technical SEO', value: scores['Technical SEO'] || 0, color: 'sky' },
          { label: 'Off-Page SEO', value: scores['Off-Page SEO'] || 0, color: 'fuchsia' },
          { label: 'Social Media', value: scores['Social Media'] || 0, color: 'rose' },
        ];
        const ss = document.getElementById('sectionScores');
        ss.innerHTML = '';
        cards.forEach(c => {
          const div = document.createElement('div');
          div.className = `glass-panel rounded-2xl p-6 border-b-[3px] border-${c.color}-500 shadow-panel`;
          div.innerHTML = `
            <p class="text-[11px] font-bold opacity-60 uppercase">${c.label}</p>
            <div class="text-3xl font-black mt-1">${c.value}%</div>
          `;
          ss.appendChild(div);
        });

        // Overview
        document.getElementById('seoOverview').innerText = data.seo_audit.overview_text || '';

        // Competitor analysis
        const compDiv = document.getElementById('competitorAnalysis');
        compDiv.querySelectorAll('.panel').forEach(el => el.remove());
        const analysis = data.seo_audit.competitor_analysis || data.seo_audit.competator_analysis;
        if (analysis?.types) {
          analysis.types.forEach(type => {
            const panel = document.createElement('div');
            panel.className = 'panel mb-3 border border-white/10 rounded-xl overflow-hidden';

            const header = document.createElement('button');
            header.type = 'button';
            header.className = 'w-full flex justify-between items-center bg-white/6 px-4 py-3';
            header.innerHTML = `
              <span class="font-semibold text-brand-400">${type.type}</span>
              <i class="fa-solid fa-chevron-down text-slate-400"></i>
            `;

            const body = document.createElement('div');
            body.className = 'hidden px-4 py-3';
            body.innerHTML = `<p class="text-slate-300 text-sm mb-2">${type.description}</p>`;

            const list = document.createElement('ul');
            list.className = 'list-disc pl-6 text-slate-200';
            type.competitors.forEach(c => {
              const li = document.createElement('li');
              li.innerText = `${c.label} (${c.domain}) — Common Keywords: ${c.common_keywords}, Competition Level: ${c.competition_level}`;
              list.appendChild(li);
            });
            body.appendChild(list);

            header.addEventListener('click', () => {
              body.classList.toggle('hidden');
              header.querySelector('i').classList.toggle('rotate-180');
            });

            panel.appendChild(header);
            panel.appendChild(body);
            compDiv.appendChild(panel);
          });

          // Batch controls
          document.getElementById('expandCompetitors').onclick = () => {
            compDiv.querySelectorAll('.panel > div').forEach(b => b.classList.remove('hidden'));
            compDiv.querySelectorAll('.panel button i').forEach(i => i.classList.add('rotate-180'));
          };
          document.getElementById('collapseCompetitors').onclick = () => {
            compDiv.querySelectorAll('.panel > div').forEach(b => b.classList.add('hidden'));
            compDiv.querySelectorAll('.panel button i').forEach(i => i.classList.remove('rotate-180'));
          };
        }
      }

      window.scrollTo({ top: results.offsetTop - 40, behavior: 'smooth' });
    }

    // PDF export
    document.getElementById('downloadPdf').addEventListener('click', async () => {
      if (!window.currentAuditData) return;
      const btn = document.getElementById('downloadPdf');
      const originalHtml = btn.innerHTML;
      btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin mr-2"></i> PROCESSING';

      try {
        const response = await fetch('/download', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(window.currentAuditData)
        });
        const blob = await response.blob();
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `FF_Elite_Audit_${new Date().getTime()}.pdf`;
        document.body.appendChild(a);
        a.click();
        a.remove();
      } catch (err) {
        alert("PDF Engine Failure");
      } finally {
        btn.innerHTML = originalHtml;
      }
    });
  </script>
</body>
</html>
