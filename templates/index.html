<!DOCTYPE html>
<html lang="en" class="h-full scroll-smooth dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>FF Tech Elite | Ultimate Website Audit</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
  body { font-family: 'Inter', sans-serif; }
  .hidden { display: none; }
  .chart-container { position: relative; height: 220px; width: 100%; }
  .glass-card { 
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }
  .dark .glass-card {
    background: rgba(30, 41, 59, 0.7);
  }
  .glass-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
  }
  .input-focus:focus {
    outline: none;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
    border-color: #3b82f6;
  }
</style>
</head>
<body class="bg-slate-50 dark:bg-slate-950 text-slate-900 dark:text-slate-100 min-h-screen transition-colors duration-300">

<header class="sticky top-0 z-50 bg-white/80 dark:bg-slate-900/80 backdrop-blur-md border-b border-slate-200 dark:border-slate-800 p-4">
  <div class="max-w-7xl mx-auto flex justify-between items-center">
    <div class="flex items-center space-x-2">
      <div class="w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center">
        <span class="text-white font-bold text-xs">FF</span>
      </div>
      <h1 class="text-lg font-bold tracking-tight bg-gradient-to-r from-indigo-600 to-blue-500 bg-clip-text text-transparent">FF Tech Elite</h1>
    </div>
    <button id="toggle-dark" class="p-2 rounded-xl bg-slate-100 dark:bg-slate-800 hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
      </svg>
    </button>
  </div>
</header>

<main class="p-6 max-w-7xl mx-auto space-y-8">

  <div class="grid md:grid-cols-2 gap-6">
    <section class="p-8 glass-card rounded-2xl border border-slate-200 dark:border-slate-800 shadow-sm">
      <h2 class="text-xl font-bold mb-4 flex items-center">
        <span class="mr-2">üöÄ</span> Open New Audit
      </h2>
      <div class="flex flex-col space-y-3">
        <input id="audit-url" type="url" placeholder="https://yourwebsite.com" class="input-focus w-full p-3 rounded-xl bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-700 transition-all">
        <button id="run-audit" class="w-full py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-xl shadow-lg shadow-indigo-500/20 transition-all active:scale-95">Run Analysis</button>
      </div>
      <p id="audit-status" class="mt-4 text-sm font-medium text-indigo-600 dark:text-indigo-400 italic"></p>
    </section>

    <section class="p-8 glass-card rounded-2xl border border-slate-200 dark:border-slate-800 shadow-sm">
      <h2 class="text-xl font-bold mb-4 flex items-center">
        <span class="mr-2">üîê</span> Pro Access
      </h2>
      <div class="flex flex-col space-y-3">
        <input id="email-login" type="email" placeholder="email@company.com" class="input-focus w-full p-3 rounded-xl bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-700 transition-all">
        <button id="send-link" class="w-full py-3 bg-slate-800 dark:bg-slate-100 dark:text-slate-900 text-white font-semibold rounded-xl transition-all">Send Magic Link</button>
      </div>
      <p id="login-status" class="mt-4 text-sm font-medium text-slate-500"></p>
    </section>
  </div>

  <div id="subscription-alert" class="hidden glass-card border-l-4 border-yellow-500 bg-yellow-50 dark:bg-yellow-900/20 p-6 rounded-2xl flex flex-col md:flex-row items-center justify-between">
    <div class="text-yellow-800 dark:text-yellow-200">
      <span class="font-bold text-lg block">Audit Limit Reached!</span>
      You've used your 5 free monthly audits. Upgrade to Pro for unlimited access.
    </div>
    <button id="subscribe-btn" class="mt-4 md:mt-0 px-8 py-3 bg-yellow-500 hover:bg-yellow-600 text-white font-bold rounded-xl shadow-lg shadow-yellow-500/30">Upgrade for $5/mo</button>
  </div>

  <section id="audit-results" class="hidden space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-700">
    
    <div class="flex items-center justify-between border-b border-slate-200 dark:border-slate-800 pb-4">
      <h2 class="text-3xl font-extrabold tracking-tight">Report Dashboard</h2>
      <a id="download-pdf" href="#" class="inline-flex items-center px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg text-sm font-medium transition-colors">
        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
        Export PDF
      </a>
    </div>

    <div class="p-8 bg-gradient-to-br from-indigo-600 to-blue-700 rounded-3xl text-white shadow-xl">
      <h3 class="text-xl font-bold mb-3 opacity-90 uppercase tracking-wider text-sm">Executive Summary</h3>
      <p id="executive-summary" class="text-lg leading-relaxed font-light">Analyzing your data...</p>
    </div>

    <div id="metrics-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      <div class="p-6 glass-card rounded-2xl border border-slate-200 dark:border-slate-800 shadow-sm flex flex-col">
        <h3 class="text-sm font-bold text-slate-500 dark:text-slate-400 uppercase tracking-widest mb-4">Overall Health</h3>
        <div class="chart-container"><canvas id="chart-overall-score"></canvas></div>
      </div>
      <div class="p-6 glass-card rounded-2xl border border-slate-200 dark:border-slate-800 shadow-sm flex flex-col">
        <h3 class="text-sm font-bold text-slate-500 dark:text-slate-400 uppercase tracking-widest mb-4">Technical SEO</h3>
        <div class="chart-container"><canvas id="chart-technical-seo"></canvas></div>
      </div>
      <div class="p-6 glass-card rounded-2xl border border-slate-200 dark:border-slate-800 shadow-sm flex flex-col">
        <h3 class="text-sm font-bold text-slate-500 dark:text-slate-400 uppercase tracking-widest mb-4">On-Page SEO</h3>
        <div class="chart-container"><canvas id="chart-onpage-seo"></canvas></div>
      </div>
      <div class="p-6 glass-card rounded-2xl border border-slate-200 dark:border-slate-800 shadow-sm flex flex-col">
        <h3 class="text-sm font-bold text-slate-500 dark:text-slate-400 uppercase tracking-widest mb-4">Performance</h3>
        <div class="chart-container"><canvas id="chart-performance"></canvas></div>
      </div>
      <div class="p-6 glass-card rounded-2xl border border-slate-200 dark:border-slate-800 shadow-sm flex flex-col">
        <h3 class="text-sm font-bold text-slate-500 dark:text-slate-400 uppercase tracking-widest mb-4">Security</h3>
        <div class="chart-container"><canvas id="chart-security"></canvas></div>
      </div>
      <div class="p-6 glass-card rounded-2xl border border-slate-200 dark:border-slate-800 shadow-sm flex flex-col">
        <h3 class="text-sm font-bold text-slate-500 dark:text-slate-400 uppercase tracking-widest mb-4">Mobile Readiness</h3>
        <div class="chart-container"><canvas id="chart-mobile"></canvas></div>
      </div>
      <div class="p-6 glass-card rounded-2xl border border-slate-200 dark:border-slate-800 shadow-sm flex flex-col">
        <h3 class="text-sm font-bold text-slate-500 dark:text-slate-400 uppercase tracking-widest mb-4">Accessibility</h3>
        <div class="chart-container"><canvas id="chart-usability"></canvas></div>
      </div>
      <div class="p-6 glass-card rounded-2xl border border-slate-200 dark:border-slate-800 shadow-sm flex flex-col">
        <h3 class="text-sm font-bold text-slate-500 dark:text-slate-400 uppercase tracking-widest mb-4">Backlink Authority</h3>
        <div class="chart-container"><canvas id="chart-backlinks"></canvas></div>
      </div>
      <div class="p-6 glass-card rounded-2xl border border-slate-200 dark:border-slate-800 shadow-sm flex flex-col">
        <h3 class="text-sm font-bold text-slate-500 dark:text-slate-400 uppercase tracking-widest mb-4">Content Quality</h3>
        <div class="chart-container"><canvas id="chart-content"></canvas></div>
      </div>
    </div>

    <div class="grid md:grid-cols-3 gap-6">
      <div class="md:col-span-2 p-8 glass-card rounded-2xl border border-slate-200 dark:border-slate-800">
        <h3 class="text-xl font-bold mb-6">Action Plan & Trend</h3>
        <div class="space-y-6">
          <div id="chart-history-container" class="h-[300px]">
             <canvas id="chart-history"></canvas>
          </div>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-8">
            <div class="p-4 rounded-xl bg-green-50 dark:bg-green-900/20 border border-green-100 dark:border-green-800">
              <span class="text-xs font-bold text-green-600 dark:text-green-400 uppercase">Recommendations</span>
              <p id="recommendations-list" class="text-sm mt-1"></p>
            </div>
            <div class="p-4 rounded-xl bg-red-50 dark:bg-red-900/20 border border-red-100 dark:border-red-800">
              <span class="text-xs font-bold text-red-600 dark:text-red-400 uppercase">Weak Areas</span>
              <p id="weak-areas-list" class="text-sm mt-1"></p>
            </div>
          </div>
        </div>
      </div>

      <div class="p-8 glass-card rounded-2xl border border-slate-200 dark:border-slate-800 bg-slate-900 text-white">
        <h3 class="text-xl font-bold mb-4">Competitor Score</h3>
        <div class="chart-container h-48"><canvas id="chart-competitor"></canvas></div>
        <div class="mt-6 pt-6 border-t border-slate-800">
          <h4 class="text-sm font-bold text-slate-400 mb-4">QUICK LINKS</h4>
          <ul class="space-y-4">
            <li id="py-integration"><a href="#" class="text-indigo-400 hover:text-white transition-colors flex items-center">
              <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg>
              View Python Source Audit
            </a></li>
          </ul>
        </div>
      </div>
    </div>

  </section>
</main>

<footer class="mt-12 py-12 bg-white dark:bg-slate-900 border-t border-slate-200 dark:border-slate-800 text-center">
  <p class="text-slate-500 dark:text-slate-400 text-sm">&copy; 2025 FF Tech Elite | Ultimate Website Audit</p>
</footer>

<script>
// Dark Mode Toggle Logic
document.getElementById('toggle-dark').addEventListener('click', ()=>{
  document.documentElement.classList.toggle('dark');
});

// Logic variables
let auditCount = 0;
const maxFreeAudits = 5;
let historyChart;

// Helper function for Chart styles
const getChartConfig = (label, data, color) => ({
  type: 'bar',
  data: {
    labels: [label],
    datasets: [{
      label: label,
      data: [data],
      backgroundColor: color,
      borderRadius: 8,
      borderSkipped: false,
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    plugins: { legend: { display: false } },
    scales: { 
      y: { min: 0, max: 100, grid: { display: false }, ticks: { color: '#94a3b8' } },
      x: { grid: { display: false }, ticks: { display: false } }
    }
  }
});

document.getElementById('run-audit').addEventListener('click', async ()=>{
  const url = document.getElementById('audit-url').value.trim();
  if(!url){ alert("Enter a valid URL"); return; }

  auditCount++;
  if(auditCount > maxFreeAudits){
    document.getElementById('subscription-alert').classList.remove('hidden');
    return;
  }

  document.getElementById('audit-results').classList.remove('hidden');
  document.getElementById('audit-status').innerText = `üîç Analyzing ${url}...`;

  try {
    const res = await fetch(`/api/audit?url=${encodeURIComponent(url)}`);
    const data = await res.json();
    const audit = data.audit;

    document.getElementById('executive-summary').innerText = audit.executive_summary;
    document.getElementById('py-integration').querySelector('a').href = `/run-audit?url=${encodeURIComponent(url)}`;
    
    const recoList = Object.values(audit.recommendations).join(", ");
    document.getElementById('recommendations-list').innerText = recoList;
    document.getElementById('weak-areas-list').innerText = audit.weaknesses.join(", ");
    document.getElementById('download-pdf').href = `/api/audit/pdf?url=${encodeURIComponent(url)}`;

    const charts = [
      { id:'chart-overall-score', label:'Overall', value:audit.site_health_score, color: '#6366f1' },
      { id:'chart-technical-seo', label:'Technical SEO', value:audit.metrics_summary.seo_score, color: '#818cf8' },
      { id:'chart-onpage-seo', label:'On-Page SEO', value:audit.metrics_summary.accessibility_score, color: '#4f46e5' },
      { id:'chart-performance', label:'Performance', value:audit.metrics_summary.performance_score, color: '#10b981' },
      { id:'chart-security', label:'Security', value:audit.metrics_summary.security_score, color: '#ef4444' },
      { id:'chart-mobile', label:'Mobile', value:audit.metrics_summary.mobile_friendly ? 100 : 20, color: '#f59e0b' },
      { id:'chart-usability', label:'Accessibility', value:audit.metrics_summary.accessibility_score, color: '#06b6d4' },
      { id:'chart-backlinks', label:'Backlinks', value:45, color: '#ec4899' },
      { id:'chart-content', label:'Content', value:audit.metrics_summary.pages_crawled > 100 ? 100 : audit.metrics_summary.pages_crawled, color: '#8b5cf6' },
      { id:'chart-competitor', label:'Competitor', value:audit.site_health_score - 10, color: '#ffffff' }
    ];

    charts.forEach(c => {
      const ctx = document.getElementById(c.id).getContext('2d');
      new Chart(ctx, getChartConfig(c.label, c.value, c.color));
    });

    // History chart
    const histRes = await fetch(`/api/history?url=${encodeURIComponent(url)}&limit=12`);
    const histData = await histRes.json();
    const labels = histData.points.map(p=>new Date(p.t).toLocaleDateString());
    const scores = histData.points.map(p=>p.score);
    const ctxHist = document.getElementById('chart-history').getContext('2d');

    if(historyChart) historyChart.destroy();
    
    historyChart = new Chart(ctxHist,{
      type:'line',
      data:{ 
        labels, 
        datasets:[{ 
          label: 'Health Score Trend',
          data:scores, 
          borderColor:'#6366f1', 
          backgroundColor:'rgba(99,102,241,0.1)', 
          tension:.4, 
          fill:true,
          pointBackgroundColor: '#6366f1'
        }] 
      },
      options:{ 
        responsive:true, 
        maintainAspectRatio:false,
        plugins: { legend: { display: false } },
        scales:{ y:{ min:0, max:100, ticks: { color: '#94a3b8' } }, x: { ticks: { color: '#94a3b8' } } }
      }
    });

    document.getElementById('audit-status').innerText = `‚úÖ Audit Complete: ${audit.site_health_score}% - Grade ${audit.grade}`;

  } catch(e){
    console.error(e);
    document.getElementById('audit-status').innerText = '‚ùå Audit failed. Please try again.';
  }
});

// Static Actions
document.getElementById('subscribe-btn').addEventListener('click',()=>{ alert("Redirecting to payment portal..."); });
document.getElementById('send-link').addEventListener('click', async ()=>{
  const email = document.getElementById('email-login').value.trim();
  if(!email){ alert("Enter valid email"); return; }
  document.getElementById('login-status').innerText = 'Sending magic link...';
  // Mocking the fetch based on your requirement
  setTimeout(() => { document.getElementById('login-status').innerText = 'Email sent! Check your inbox.'; }, 1000);
});
</script>
</body>
</html>
