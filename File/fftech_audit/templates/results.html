{% extends "base.html" %}
{% block title %}{{ url_display }} - Results â€¢ FF Tech AI{% endblock %}

{% block content %}
<div style="padding:40px 0;">
  <!-- Header -->
  <div class="card" style="text-align:center; max-width:800px; margin:0 auto 48px; padding:40px;">
    <h1 style="font-size:2.5rem; margin:0 0 24px;">Audit Complete</h1>
    <p style="font-size:1.3rem; color:var(--muted); margin:0 0 32px;">
      Analyzed: <strong style="color:var(--accent);">{{ url_display }}</strong>
    </p>
    
    <!-- Overall Score -->
    <div style="display:flex; align-items:center; justify-content:center; gap:40px; flex-wrap:wrap;">
      <div style="text-align:center;">
        <canvas id="overallChart" width="220" height="220" style="max-width:100%;"></canvas>
        <div style="font-size:2.8rem; font-weight:800; margin:16px 0 8px; color:var(--accent);">
          {{ "%.0f"|format(score) }}%
        </div>
        <div class="badge" style="font-size:1.2rem; padding:8px 20px; 
          background:{% if score >= 90 %}#0a0{% elif score >= 70 %}#ffaa00{% else %}#f66{% endif %};
          color:{% if score >= 90 %}#000{% else %}#fff{% endif %}">
          {{ grade }}
        </div>
      </div>
    </div>
  </div>

  <!-- Category Grid -->
  <div class="card" style="margin-bottom:48px;">
    <h2 style="text-align:center; font-size:1.8rem; margin:0 0 32px;">Category Scores</h2>
    <div class="grid">
      <div class="category">
        <h4>Security</h4>
        <div class="progress"><div style="width:{{ rows[0].value if rows else 0 }}%;"></div></div>
        <small>{{ "%.1f"|format(rows[0].value if rows else 0) }}</small>
      </div>
      <div class="category">
        <h4>Performance</h4>
        <div class="progress"><div style="width:{{ rows[10].value if len(rows)>10 else 0 }}%;"></div></div>
        <small>{{ "%.1f"|format(rows[10].value if len(rows)>10 else 0) }}</small>
      </div>
      <div class="category">
        <h4>SEO</h4>
        <div class="progress"><div style="width:{{ rows[20].value if len(rows)>20 else 0 }}%;"></div></div>
        <small>{{ "%.1f"|format(rows[20].value if len(rows)>20 else 0) }}</small>
      </div>
      <div class="category">
        <h4>Mobile</h4>
        <div class="progress"><div style="width:{{ rows[30].value if len(rows)>30 else 0 }}%;"></div></div>
        <small>{{ "%.1f"|format(rows[30].value if len(rows)>30 else 0) }}</small>
      </div>
      <div class="category">
        <h4>Content</h4>
        <div class="progress"><div style="width:{{ rows[40].value if len(rows)>40 else 0 }}%;"></div></div>
        <small>{{ "%.1f"|format(rows[40].value if len(rows)>40 else 0) }}</small>
      </div>
    </div>
    <div style="max-width:900px; margin:32px auto 0;">
      <canvas id="barChart" height="160"></canvas>
    </div>
  </div>

  <!-- Metrics Table -->
  <div class="card">
    <h2 style="margin:0 0 24px;">Detailed Metrics (Top 50)</h2>
    <div class="table-wrap">
      <table class="metrics">
        <thead>
          <tr><th>#</th><th>Metric</th><th>Category</th><th>Value</th></tr>
        </thead>
        <tbody>
          {% for row in rows[:50] %}
          <tr>
            <td>{{ row.id }}</td>
            <td style="max-width:300px;">{{ row.name }}</td>
            <td>{{ row.category }}</td>
            <td style="color:{% if row.value >= 80 %}#0a0{% elif row.value >= 50 %}#ffaa00{% else %}#f66{% endif %}">
              {{ "%.1f"|format(row.value) if row.value != 'N/A' else row.value }}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  {% if ENABLE_AUTH %}
  <div style="text-align:center; margin:60px 0;">
    <a href="/auth/register" style="display:inline-block; padding:18px 48px; background:var(--accent); 
      color:#000; font-weight:700; font-size:1.3rem; border-radius:16px; text-decoration:none; 
      box-shadow:var(--glow);">
      Save Report & Get PDF
    </a>
  </div>
  {% endif %}
</div>

<script>
  window.FFTECH_DATA = {
    score: {{ score }},
    categories: {
      security: {{ rows[0].value if rows else 0 }},
      performance: {{ rows[10].value if len(rows)>10 else 0 }},
      seo: {{ rows[20].value if len(rows)>20 else 0 }},
      mobile: {{ rows[30].value if len(rows)>30 else 0 }},
      content: {{ rows[40].value if len(rows)>40 else 0 }}
    }
  };
</script>
{% endblock %}
