{% extends "base.html" %}

{% block title %}{{ url }} - Audit Results • FF Tech AI{% endblock %}

{% block content %}
<div class="container" style="padding: 40px 0 80px;">
  <h1 style="text-align: center; font-size: 2.8rem; margin-bottom: 40px; color: var(--text);">
    Audit Results for <span style="color: var(--accent);">{{ url }}</span>
  </h1>

  <!-- Overall Score -->
  <div class="card" style="max-width: 700px; margin: 0 auto 48px; text-align: center;">
    <div class="overall">
      <div class="gauge" style="margin: 0 auto 24px; max-width: 240px;">
        <canvas id="overallChart"></canvas>
      </div>
      <div style="font-size: 2.4rem; margin-bottom: 12px;">
        Overall Score: 
        <strong style="color: var(--accent); font-size: 3.2rem;">{{ score|round(0) }}%</strong>
      </div>
      <div style="margin-bottom: 16px;">
        <span class="badge" style="
          font-size: 1.4rem; 
          padding: 8px 16px; 
          background: {% if score >= 90 %}#0a0{% elif score >= 70 %}#ffaa00{% else %}#ff6666{% endif %};
          color: {% if score >= 90 %}#000{% else %}#fff{% endif %};
        ">
          {{ grade }}
        </span>
      </div>
      <div style="color: var(--muted); font-size: 1.1rem;">
        Errors: <strong style="color: #ff6666;">{{ errors_count }}</strong> • 
        Warnings: <strong style="color: #ffaa00;">{{ warnings_count }}</strong> • 
        Notices: <strong style="color: #999;">{{ notices_count }}</strong>
      </div>
    </div>
  </div>

  <!-- Category Breakdown -->
  <div class="card" style="margin-bottom: 48px;">
    <h3 style="text-align: center; font-size: 1.8rem; margin-bottom: 32px;">Category Breakdown</h3>

    <div class="grid" style="margin-bottom: 40px;">
      {% set cats = {
        'Security': category_scores.security,
        'Performance': category_scores.performance,
        'SEO': category_scores.seo,
        'Mobile': category_scores.mobile,
        'Content': category_scores.content
      } %}
      {% for name, val in cats.items() %}
      <div class="category">
        <h4>{{ name }}</h4>
        <div class="progress"><div style="width: {{ val }}%;"></div></div>
        <div style="margin-top: 8px; font-weight: 600; color: var(--accent);">
          {{ val|round(1) }} / 100
        </div>
      </div>
      {% endfor %}
    </div>

    <div style="max-width: 900px; margin: 0 auto;">
      <canvas id="barChart"></canvas>
    </div>
  </div>

  <!-- Insights Grid -->
  <div class="grid three" style="margin: 60px 0;">
    <div class="card">
      <h3>Strengths</h3>
      <ul style="margin: 16px 0; padding-left: 20px;">
        {% for item in strengths %}
          <li>{{ item }}</li>
        {% else %}
          <li style="color: var(--muted);">No major strengths detected.</li>
        {% endfor %}
      </ul>
    </div>

    <div class="card">
      <h3>Weak Areas</h3>
      <ul style="margin: 16px 0; padding-left: 20px;">
        {% for item in weaknesses %}
          <li>{{ item }}</li>
        {% else %}
          <li style="color: var(--muted);">No critical weaknesses found.</li>
        {% endfor %}
      </ul>
    </div>

    <div class="card">
      <h3>Priority Fixes</h3>
      <ul style="margin: 16px 0; padding-left: 20px;">
        {% for item in priority_fixes %}
          <li>{{ item }}</li>
        {% else %}
          <li style="color: var(--muted);">All critical issues resolved!</li>
        {% endfor %}
      </ul>
    </div>
  </div>

  <!-- Detailed Metrics -->
  <div class="card">
    <h3 style="margin-bottom: 24px;">Detailed Metrics</h3>
    <div class="table-wrap">
      <table class="metrics">
        <thead>
          <tr>
            <th>#</th>
            <th>Metric</th>
            <th>Category</th>
            <th>Value</th>
          </tr>
        </thead>
        <tbody>
          {% for row in rows %}
          <tr>
            <td>{{ loop.index }}</td>
            <td>{{ row.name }}</td>
            <td>{{ row.category|title }}</td>
            <td style="font-weight: 600; color: {% if row.value >= 80 %}#0f0{% elif row.value >= 50 %}#ffaa00{% else %}#ff6666{% endif %};">
              {{ row.value }}{% if row.value <= 100 %}%{% endif %}
            </td>
          </tr>
          {% else %}
          <tr>
            <td colspan="4" style="text-align: center; color: var(--muted); padding: 20px;">
              No detailed metrics available.
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Optional CTA -->
  {% if ENABLE_AUTH %}
  <div style="text-align: center; margin: 60px 0;">
    <a href="/auth/register" style="
      display: inline-block;
      padding: 16px 48px;
      font-size: 1.4rem;
      font-weight: 700;
      background: var(--accent);
      color: white;
      text-decoration: none;
      border-radius: 16px;
      box-shadow: var(--glow-primary);
      transition: all 0.3s;
    ">
      Save Report & Download PDF
    </a>
  </div>
  {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script>
  // Data injection for app.js charts
  window.FFTECH_DATA = {
    score: {{ score|round(1) }},
    categories: {
      security: {{ category_scores.security|round(1) }},
      performance: {{ category_scores.performance|round(1) }},
      seo: {{ category_scores.seo|round(1) }},
      mobile: {{ category_scores.mobile|round(1) }},
      content: {{ category_scores.content|round(1) }}
    }
  };
</script>
{% endblock %}
