
{% extends "base.html" %}

{% block content %}

{# Optional: show an error banner if the backend passed an error string #}
{% if error %}
  <div class="alert alert-warning">
    Audit could not complete: {{ error }}
  </div>
{% endif %}

{# Compute a safe score for the 11th metric (index 10) #}
{% set score_10 = 0 %}
{% if rows is iterable and rows|length > 10 and rows[10] is defined %}
  {% if rows[10].value is defined %}
    {% set score_10 = rows[10].value %}
  {% endif %}
{% endif %}

{# Clamp score_10 between 0 and 100 just in case #}
{% if score_10 < 0 %}
  {% set score_10 = 0 %}
{% elif score_10 > 100 %}
  {% set score_10 = 100 %}
{% endif %}

<div class="progress">
  <div style="width:{{ score_10 }}%;"></div>
</div>

{# Render rows table safely #}
{% if rows|length > 0 %}
  <table class="metrics-table">
    <thead>
      <tr>
        <th>Metric</th>
        <th>Value</th>
      </tr>
    </thead>
    <tbody>
      {% for r in rows %}
        <tr>
          <td>{{ r.name if r.name is defined else 'Unnamed' }}</td>
          <td>{{ r.value if r.value is defined else '-' }}</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
{% else %}
  <p>No metrics available yet.</p>
{% endif %}

{% endblock %}
